<!doctype html><html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta><title>Angular universal服务器端渲染与预渲染 - 鹏叔的技术博客</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="鹏叔的技术博客"><meta name="msapplication-TileImage" content="/images/favicon-16x16-next.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="鹏叔的技术博客"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="1. 前言 2. 什么是 Angular universal 3. 为什么需要 SSR(服务器端渲染) 4. Angular Universal 如何解决 FCP 和 SEO 问题 5. 开启 SSR 6. 开启客户端水合(Client Hydration) 7. 使用 Universal 构建和运行 8. Prerender 预渲染静态 HTML 8.1. 预渲染路径配置   9. SEO 优"><meta property="og:type" content="blog"><meta property="og:title" content="鹏叔的技术博客"><meta property="og:url" content="https://pengtech.net/"><meta property="og:site_name" content="鹏叔的技术博客"><meta property="og:description" content="1. 前言 2. 什么是 Angular universal 3. 为什么需要 SSR(服务器端渲染) 4. Angular Universal 如何解决 FCP 和 SEO 问题 5. 开启 SSR 6. 开启客户端水合(Client Hydration) 7. 使用 Universal 构建和运行 8. Prerender 预渲染静态 HTML 8.1. 预渲染路径配置   9. SEO 优"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://pengtech.net/img/og_image.png"><meta property="article:published_time" content="2023-05-02T16:00:00.000Z"><meta property="article:modified_time" content="2024-07-10T10:42:45.386Z"><meta property="article:author" content="eagle"><meta property="article:tag" content="javascript"><meta property="article:tag" content="Angular"><meta property="article:tag" content="SEO"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://pengtech.net/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://pengtech.net/angular/angular_universal.html"},"headline":"Angular universal服务器端渲染与预渲染","image":["https://pengtech.net/img/og_image.png"],"datePublished":"2023-05-02T16:00:00.000Z","dateModified":"2024-07-10T10:42:45.386Z","author":{"@type":"Person","name":"鹏叔"},"publisher":{"@type":"Organization","name":"鹏叔的技术博客","logo":{"@type":"ImageObject","url":{"text":"鹏叔的技术博客"}}},"description":"1. 前言 2. 什么是 Angular universal 3. 为什么需要 SSR(服务器端渲染) 4. Angular Universal 如何解决 FCP 和 SEO 问题 5. 开启 SSR 6. 开启客户端水合(Client Hydration) 7. 使用 Universal 构建和运行 8. Prerender 预渲染静态 HTML 8.1. 预渲染路径配置   9. SEO 优"}</script><link rel="canonical" href="https://pengtech.net/angular/angular_universal.html"><link rel="alternate" href="/atom.xml" title="鹏叔的技术博客" type="application/atom+xml"><link rel="icon" href="/images/favicon-16x16-next.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link data-pjax rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link data-pjax rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script"),t=(e.src="//hm.baidu.com/hm.js?1da0f55a32eb17a877b1b18efa3d0406",document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)}()</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=G-ZZTM0Y954E" async></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-ZZTM0Y954E")</script><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><script data-ad-client="ca-pub-9737903136672124" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async></script><meta name="follow.it-verification-code" content="FDYm0CxLRXUa9hVlR3zQ"><script>!function(){function e(){var e,t,a;location.hash&&(e="#"+CSS.escape(location.hash.substring(1)),t=document.querySelector(`.tabs a[href="${e}"]`))&&(a=t.parentElement.parentElement,Array.from(a.children).forEach(e=>e.classList.remove("is-active")),Array.from(a.querySelectorAll("a")).map(e=>document.getElementById(e.getAttribute("href").substring(1))).forEach(e=>e.classList.add("is-hidden")),t&&t.parentElement.classList.add("is-active"),a=document.querySelector(e))&&a.classList.remove("is-hidden")}e(),window.addEventListener("hashchange",e,!1)}()</script><meta name="generator" content="Hexo 7.3.0"></head><body class="is-3-column"><script type="text/javascript" src="/js/imaegoo/night.js"></script><canvas id="universe"></canvas><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">鹏叔的技术博客</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/angular">angular</a><a class="navbar-item" href="/material-design">material-design</a><a class="navbar-item" href="/linux">linux</a><a class="navbar-item" href="/gitlab">gitlab</a><a class="navbar-item" href="/frontend">frontend</a><a class="navbar-item" href="/backend">backend</a><a class="navbar-item" href="/vscode">vscode</a><a class="navbar-item" href="/hexo">hexo</a><a class="navbar-item" href="/java">java</a><a class="navbar-item" href="/golang">golang</a><a class="navbar-item" href="/v2rayA">v2rayA</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/friends">友链</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item night" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time datetime="2023-05-02T16:00:00.000Z" title="2023/5/3 00:00:00">2023-05-03</time>发表</span><span class="level-item"><time datetime="2024-07-10T10:42:45.386Z" title="2024/7/10 18:42:45">2024-07-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/web/">web</a><span> / </span><a class="link-muted" href="/categories/web/angular/">angular</a></span><span class="level-item">1 小时读完 (大约7338个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">Angular universal服务器端渲染与预渲染</h1><div class="content"><ul><li><a href="#1-%E5%89%8D%E8%A8%80">1. 前言</a></li><li><a href="#2-%E4%BB%80%E4%B9%88%E6%98%AF-angular-universal">2. 什么是 Angular universal</a></li><li><a href="#3-%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81-ssr%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E6%B8%B2%E6%9F%93">3. 为什么需要 SSR(服务器端渲染)</a></li><li><a href="#4-angular-universal-%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3-fcp-%E5%92%8C-seo-%E9%97%AE%E9%A2%98">4. Angular Universal 如何解决 FCP 和 SEO 问题</a></li><li><a href="#5-%E5%BC%80%E5%90%AF-ssr">5. 开启 SSR</a></li><li><a href="#6-%E5%BC%80%E5%90%AF%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%B0%B4%E5%90%88client-hydration">6. 开启客户端水合(Client Hydration)</a></li><li><a href="#7-%E4%BD%BF%E7%94%A8-universal-%E6%9E%84%E5%BB%BA%E5%92%8C%E8%BF%90%E8%A1%8C">7. 使用 Universal 构建和运行</a></li><li><a href="#8-prerender-%E9%A2%84%E6%B8%B2%E6%9F%93%E9%9D%99%E6%80%81-html">8. Prerender 预渲染静态 HTML</a><ul><li><a href="#81-%E9%A2%84%E6%B8%B2%E6%9F%93%E8%B7%AF%E5%BE%84%E9%85%8D%E7%BD%AE">8.1. 预渲染路径配置</a></li></ul></li><li><a href="#9-seo-%E4%BC%98%E5%8C%96">9. SEO 优化</a><ul><li><a href="#91-%E5%85%B3%E9%94%AE%E8%AF%8D%E4%B8%8E%E6%8F%8F%E8%BF%B0%E7%9A%84%E4%BC%98%E5%8C%96">9.1. 关键词与描述的优化</a></li><li><a href="#92-%E5%86%85%E9%83%A8%E8%B7%B3%E8%BD%AC%E4%BC%98%E5%8C%96">9.2. 内部跳转优化</a></li><li><a href="#93-%E6%A0%B7%E5%BC%8F%E6%96%87%E4%BB%B6%E6%89%93%E5%8C%85">9.3. 样式文件打包</a></li><li><a href="#94-%E6%B7%BB%E5%8A%A0-robotstxt">9.4. 添加 robots.txt</a></li><li><a href="#95-%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90-sitemap">9.5. 自动生成 sitemap</a></li></ul></li><li><a href="#10-%E4%BD%BF%E7%94%A8-nginx-%E9%83%A8%E7%BD%B2">10. 使用 Nginx 部署</a><ul><li><a href="#101-%E5%AE%89%E8%A3%85-nginx">10.1. 安装 Nginx</a></li><li><a href="#102-%E5%AE%89%E8%A3%85-node">10.2. 安装 Node</a></li><li><a href="#103-%E5%AE%89%E8%A3%85-pm2">10.3. 安装 PM2</a></li><li><a href="#104-%E9%85%8D%E7%BD%AE%E5%B9%B6%E5%90%AF%E5%8A%A8-pm2">10.4. 配置并启动 pm2</a></li><li><a href="#105-%E9%85%8D%E7%BD%AE-nginx-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86">10.5. 配置 Nginx 反向代理</a></li></ul></li><li><a href="#11-troubleshooting">11. troubleshooting</a><ul><li><a href="#111-%E9%97%AE%E9%A2%98-1-configuration-development-is-not-set-in-the-workspace">11.1. 问题 1: Configuration ‘development’ is not set in the workspace</a></li><li><a href="#112-%E9%97%AE%E9%A2%98-2-referenceerror-window-is-not-defined">11.2. 问题 2: ReferenceError: window is not defined</a></li><li><a href="#113-%E9%97%AE%E9%A2%98-3-flex-layout-loaded-on-the-server-without-flexlayoutservermodule">11.3. 问题 3: Flex Layout loaded on the server without FlexLayoutServerModule</a></li><li><a href="#114-%E9%97%AE%E9%A2%98-4-xmlhttprequest-is-not-defined">11.4. 问题 4: XMLHttpRequest is not defined</a></li><li><a href="#115-%E9%97%AE%E9%A2%98-5-distdemo-webbrowserreferenceerror-image-is-not-defined">11.5. 问题 5： <code>\dist\demo-web\browser...ReferenceError: Image is not defined</code></a></li></ul></li><li><a href="#12-%E7%9B%B8%E5%85%B3%E9%98%85%E8%AF%BB">12. 相关阅读</a></li><li><a href="#13-%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3">13. 参考文档</a></li></ul><h2 id="1-前言"><a href="#1-前言" class="headerlink" title="1. 前言"></a>1. 前言</h2><p>当初选择将应用做成 SPA(单页应用)的时候主要是觉得用户体验非常丝滑, 当时也知道 SPA 很难做 SEO, 还是毅然决然的选择做成 SPA 应用. 当时还是 Angularjs 1.X 的时候, 就觉得 Angular 的理念跟自己对前端的看法特别契合, 后来将框架升级到 Angular 11 继而 13, 虽然费了很多时间和精力, 但是收获非常多, 由于本文的重点是 SSR 与 prerendering,所以这里不赘述原因了. 之前也了解到 Angular Universal 是做服务器端渲染的套件(SSR), 乘最近有空刚好将其引入到项目. 实现地过程中虽然遇到问题, 但是还是有些小兴奋的感觉, 一来解决了首次访问应用时白屏的问题, 二来将当初打算舍弃的 SEO 能力也找了回来, 而且整个对引入 SSR 实现 SEO 的过程还是相当轻松的, 特写此文, 以防遗忘, 也希望给后来者有所帮助.</p><span id="more"></span><h2 id="2-什么是-Angular-universal"><a href="#2-什么是-Angular-universal" class="headerlink" title="2. 什么是 Angular universal"></a>2. 什么是 Angular universal</h2><p>Angular universal 是一个用于服务器端渲染 Angular 应用程序的框架. 它允许在服务器上生成 HTML, 以便在浏览器中更快地呈现应用程序, 这对于提高应用程序的性能和搜索引擎优化(SEO)非常有用. 在使用 Angular Universal 时, 应用程序的初始加载时间可能会增加, 但是在浏览器中呈现应用程序的速度会更快, 因为大部分工作已经在服务器上完成了.</p><h2 id="3-为什么需要-SSR-服务器端渲染"><a href="#3-为什么需要-SSR-服务器端渲染" class="headerlink" title="3. 为什么需要 SSR(服务器端渲染)"></a>3. 为什么需要 SSR(服务器端渲染)</h2><p>在深入了解 Angular universal 之前, 我们需要了解一下 SSR(服务器端渲染), 一项技术的出现并流行, 一定是它解决了一类问题或者是解决了一些痛点. 那么 SSR(Server Side Rendering)的出现解决了哪些痛点呢? 相对于 MPA(Multiple Page Application)风格来说,SPA 这种架构风格有很多的优点,但是也存在非常明显两个的缺点, 而 SSR 技术的出现就是为了解决这两个痛点的. 根据本文的主题 SPA 的优缺点列举如下, 比如:</p><ul><li>更快的用户体验</li><li>更好的交互性</li><li>更好的可维护性</li></ul><p>SPA 架构风格也存在两个非常大的痛点:</p><ul><li>初始加载时间较长</li></ul><p>未经优化的 SPA 应用在进行首次内容绘制(FCP - First Contentful Paint)时会存在非常严重的首页白屏问题, 由于用户首次访问 SPA 时需要加载大量的 JS 代码, 而且要经过解析后才能开始渲染页面, 整个过程需要耗费大量的时间, 往往会大大超过用户原意等待时间 3 秒, 而且随着应用的功能增加问题越来越严重.</p><ul><li>SEO 不友好</li></ul><p>SPA 不利于搜索引擎的抓取, 由于搜索引擎使用网络爬虫来索引网页, 这些爬虫依赖 HTML 内容来理解网页的结构和内容. 然而, 在 SPA 中, 内容是由 JavaScript 动态生成的, 这意味着发送到浏览器的初始 HTML 文件通常为空或包含非常少的内容. 这使得搜索引擎难以正确索引页面, 因为它们可能无法看到由 Javascript 生成的内容. 强如 google 这样的索引擎虽然可以索引 SPA 网页内容, 但是这并不总是可靠的. 如果你想要确保 SPA 网页内容能被搜索引擎正确索引, 最好使用服务器端渲染来生成 HTML 内容并将其发送到浏览器.</p><p>而 SSR 就是为解决以上两个痛点而是的.</p><h2 id="4-Angular-Universal-如何解决-FCP-和-SEO-问题"><a href="#4-Angular-Universal-如何解决-FCP-和-SEO-问题" class="headerlink" title="4. Angular Universal 如何解决 FCP 和 SEO 问题"></a>4. Angular Universal 如何解决 FCP 和 SEO 问题</h2><p>Angular Universal 允许我们为 Angular 应用程序进行服务器端渲染. 这意味着我们可以在服务器上生成 HTML 内容并将其发送到浏览器, 而不是在浏览器中使用 Javascript 动态生成内容. 这样, 搜索引擎可以看到页面的全部内容并正确索引它, 从而解决 SPA 应用程序的 SEO 问题.</p><p>此外, Angular Universal 还可以解决 FCP(首次内容绘制)性能问题. 由于 SPA 应用程序的初始 HTML 文件通常为空或者包含非常少的内容, 因此它们需要大量的 JavaScript 代码来生成内容. 这会导致长时间的初始加载时间, 从而影响 FCP 性能. 使用 Angular Universal 进行服务器端渲染可以解决这个问题, 因为它可以在服务器上生成完整的 HTML 内容并将其发送到浏览器, 从而在让浏览器快速展现页面轮廓, 减少白屏时间, 于此同时浏览器会加载整个应用所需的 Javascript 代码, 从而提高整体的用户体验. 读到这里读者可能会有一个疑惑, 那就是 SPA 不又变成 MPA 了吗? 其实不然, HTML 内容只是为了减少用户等待时间, 在 Javascript 完全加载完成之前,给用户展示页面内容, 一旦 Javascript 加载完成, 前端页面会被重新绘制, 然后完全接管用户的交互任务. 所以在 javascript 加载完成后页面有一个非常短的闪烁, 那就是 Javascript 重新绘制 First Content 的过程. 当然这样的闪烁动作对要求苛刻的系统来说也是不可接受的, Angular 也有相应的解决办法, 后面文章会讲到.</p><p>那么具体来讲, Angular Universal 是如何进行服务器端渲染的呢?</p><p>我们知道 Javascript 是可以通过 Node.js 在在服务器端执行的, 每错 Angular Universal 正式通过 Express 这个 Node.js 应用程序框架提供的强大功能和工具在后端处理请求, 再将生成的 HTML 页面发送到前端或者喂给爬虫, 这样前端就能快速渲染页面, 爬虫也能得到某个页面完整的 HTML 内容, 从而正确地为页面建立索引.</p><p>当然这并不是完美地解决 FCP 和 SEO 问题, 因为 Node.js 执行 javascript 仍然需要时间和占用大量的服务器资源, 一旦请求增多, 频率加快, express 将会称为瓶颈, 是一个非常影响 TTFB(Time to first byte)指标的问题.</p><p>那么怎样进一步解决该问题呢, 这里有两种思路:</p><ul><li><p>一种是采用数据库缓存例如 Redis 或 Memcached, 将页面缓存起来, 当下次访问相同页面时从缓存调取, 从而避免 express 重新执行 javascript 从而提高性能. 而此方案不是本文讲解的重点, 如果要采用此方案, 请自行百度或 google 了解相关详情.</p></li><li><p>另外一种方案叫 Prerender 技术. 它在构建时就为应用程序的每个页面生成静态 HTML 文件, 而不是依赖 JavaScript 在运行时动态生成内容. 当用户请求页面时, 这些静态 HTML 文件可以直接发送到用户浏览器, 从而提高首次内容呈现(FCP)的时间, 并使搜索引擎更容易爬取和索引内容.</p></li></ul><h2 id="5-开启-SSR"><a href="#5-开启-SSR" class="headerlink" title="5. 开启 SSR"></a>5. 开启 SSR</h2><p>您可以使用@nguniversal&#x2F;express-engine 依赖包在 Angular 应用程序中启用服务器端渲染，如下:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 进入项目根目录</span></span><br><span class="line"><span class="comment"># 添加express-engine</span></span><br><span class="line">ng add @nguniversal/express-engine</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>说明: Angular Universal 需要 Node.js 的 Active LTS 版本或维护 LTS 版本。有关信息，请参阅<a target="_blank" rel="noopener" href="https://angular.io/guide/versions">版本兼容性</a>指南以了解当前支持的版本。</p></blockquote><p>该命令更新应用程序代码以启用 SSR，并向项目结构中添加额外的文件。</p><p>该命令会新增以下三个文件, 并修改以下一些文件</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">src / main.<span class="property">server</span>.<span class="property">ts</span>; <span class="comment">// &lt;-- * server-side application configuration (standalone app only)</span></span><br><span class="line">src / app / app.<span class="property">server</span>.<span class="property">module</span>.<span class="property">ts</span>; <span class="comment">// &lt;-- * server-side application module (NgModule app only)</span></span><br><span class="line">server.<span class="property">ts</span>; <span class="comment">// &lt;-- * express web server</span></span><br></pre></td></tr></table></figure><p>angular-universal-demo&#x2F;angular.json</p><blockquote><p>注意: 此处的 angular.json 有一些手动更改, 主要在”serve-ssr”这个节点, 主要是为了解决 Angular 的一个 bug.<br>bug 详情请参考这个<a target="_blank" rel="noopener" href="https://github.com/angular/universal/issues/2158">issue report - Congiguration ‘development’ is not set in the workspace</a></p></blockquote><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">--- a/angular-universal-demo/angular.json</span></span><br><span class="line"><span class="comment">+++ b/angular-universal-demo/angular.json</span></span><br><span class="line"><span class="meta">@@ -36,7 +36,7 @@</span></span><br><span class="line">         &quot;build&quot;: &#123;</span><br><span class="line">           &quot;builder&quot;: &quot;@angular-devkit/build-angular:browser&quot;,</span><br><span class="line">           &quot;options&quot;: &#123;</span><br><span class="line"><span class="deletion">-            &quot;outputPath&quot;: &quot;dist/angular-universal-demo&quot;,</span></span><br><span class="line"><span class="addition">+            &quot;outputPath&quot;: &quot;dist/angular-universal-demo/browser&quot;,</span></span><br><span class="line">             &quot;index&quot;: &quot;src/index.html&quot;,</span><br><span class="line">             &quot;main&quot;: &quot;src/main.ts&quot;,</span><br><span class="line">             &quot;polyfills&quot;: &quot;src/polyfills.ts&quot;,</span><br><span class="line"><span class="meta">@@ -152,6 +152,73 @@</span></span><br><span class="line">               &quot;devServerTarget&quot;: &quot;angular-universal-demo:serve:dev&quot;</span><br><span class="line">             &#125;</span><br><span class="line">           &#125;</span><br><span class="line"><span class="addition">+        &#125;,</span></span><br><span class="line"><span class="addition">+        &quot;server&quot;: &#123;</span></span><br><span class="line"><span class="addition">+          &quot;builder&quot;: &quot;@angular-devkit/build-angular:server&quot;,</span></span><br><span class="line"><span class="addition">+          &quot;options&quot;: &#123;</span></span><br><span class="line"><span class="addition">+            &quot;outputPath&quot;: &quot;dist/angular-universal-demo/server&quot;,</span></span><br><span class="line"><span class="addition">+            &quot;main&quot;: &quot;server.ts&quot;,</span></span><br><span class="line"><span class="addition">+            &quot;tsConfig&quot;: &quot;tsconfig.server.json&quot;,</span></span><br><span class="line"><span class="addition">+            &quot;optimization&quot;: false,</span></span><br><span class="line"><span class="addition">+            &quot;sourceMap&quot;: true,</span></span><br><span class="line"><span class="addition">+            &quot;extractLicenses&quot;: false</span></span><br><span class="line"><span class="addition">+          &#125;,</span></span><br><span class="line"><span class="addition">+          &quot;configurations&quot;: &#123;</span></span><br><span class="line"><span class="addition">+            &quot;production&quot;: &#123;</span></span><br><span class="line"><span class="addition">+              &quot;outputHashing&quot;: &quot;media&quot;,</span></span><br><span class="line"><span class="addition">+              &quot;fileReplacements&quot;: [</span></span><br><span class="line"><span class="addition">+                &#123;</span></span><br><span class="line"><span class="addition">+                  &quot;replace&quot;: &quot;src/environments/environment.ts&quot;,</span></span><br><span class="line"><span class="addition">+                  &quot;with&quot;: &quot;src/environments/environment.prod.ts&quot;</span></span><br><span class="line"><span class="addition">+                &#125;</span></span><br><span class="line"><span class="addition">+              ],</span></span><br><span class="line"><span class="addition">+              &quot;optimization&quot;: true,</span></span><br><span class="line"><span class="addition">+              &quot;sourceMap&quot;: false,</span></span><br><span class="line"><span class="addition">+              &quot;extractLicenses&quot;: true</span></span><br><span class="line"><span class="addition">+            &#125;,</span></span><br><span class="line"><span class="addition">+            &quot;dev&quot;: &#123;</span></span><br><span class="line"><span class="addition">+              &quot;fileReplacements&quot;: [</span></span><br><span class="line"><span class="addition">+                &#123;</span></span><br><span class="line"><span class="addition">+                  &quot;replace&quot;: &quot;src/environments/environment.ts&quot;,</span></span><br><span class="line"><span class="addition">+                  &quot;with&quot;: &quot;src/environments/environment.dev.ts&quot;</span></span><br><span class="line"><span class="addition">+                &#125;</span></span><br><span class="line"><span class="addition">+              ]</span></span><br><span class="line"><span class="addition">+            &#125;</span></span><br><span class="line"><span class="addition">+          &#125;,</span></span><br><span class="line"><span class="addition">+          &quot;defaultConfiguration&quot;: &quot;production&quot;</span></span><br><span class="line"><span class="addition">+        &#125;,</span></span><br><span class="line"><span class="addition">+        &quot;serve-ssr&quot;: &#123;</span></span><br><span class="line"><span class="addition">+          &quot;builder&quot;: &quot;@nguniversal/builders:ssr-dev-server&quot;,</span></span><br><span class="line"><span class="addition">+          &quot;options&quot;: &#123;</span></span><br><span class="line"><span class="addition">+              &quot;browserTarget&quot;: &quot;angular-universal-demo:build&quot;,</span></span><br><span class="line"><span class="addition">+              &quot;serverTarget&quot;: &quot;angular-universal-demo:server&quot;</span></span><br><span class="line"><span class="addition">+          &#125;,</span></span><br><span class="line"><span class="addition">+          &quot;configurations&quot;: &#123;</span></span><br><span class="line"><span class="addition">+            &quot;production&quot;: &#123;</span></span><br><span class="line"><span class="addition">+              &quot;browserTarget&quot;: &quot;angular-universal-demo:build:production&quot;,</span></span><br><span class="line"><span class="addition">+              &quot;serverTarget&quot;: &quot;angular-universal-demo:server:production&quot;</span></span><br><span class="line"><span class="addition">+            &#125;</span></span><br><span class="line"><span class="addition">+          &#125;</span></span><br><span class="line"><span class="addition">+        &#125;,</span></span><br><span class="line"><span class="addition">+        &quot;prerender&quot;: &#123;</span></span><br><span class="line"><span class="addition">+          &quot;builder&quot;: &quot;@nguniversal/builders:prerender&quot;,</span></span><br><span class="line"><span class="addition">+          &quot;options&quot;: &#123;</span></span><br><span class="line"><span class="addition">+            &quot;routes&quot;: [</span></span><br><span class="line"><span class="addition">+              &quot;/&quot;</span></span><br><span class="line"><span class="addition">+            ]</span></span><br><span class="line"><span class="addition">+          &#125;,</span></span><br><span class="line"><span class="addition">+          &quot;configurations&quot;: &#123;</span></span><br><span class="line"><span class="addition">+            &quot;production&quot;: &#123;</span></span><br><span class="line"><span class="addition">+              &quot;browserTarget&quot;: &quot;angular-universal-demo:build:production&quot;,</span></span><br><span class="line"><span class="addition">+              &quot;serverTarget&quot;: &quot;angular-universal-demo:server:production&quot;</span></span><br><span class="line"><span class="addition">+            &#125;,</span></span><br><span class="line"><span class="addition">+            &quot;development&quot;: &#123;</span></span><br><span class="line"><span class="addition">+              &quot;browserTarget&quot;: &quot;angular-universal-demo:build:development&quot;,</span></span><br><span class="line"><span class="addition">+              &quot;serverTarget&quot;: &quot;angular-universal-demo:server:development&quot;</span></span><br><span class="line"><span class="addition">+            &#125;</span></span><br><span class="line"><span class="addition">+          &#125;,</span></span><br><span class="line"><span class="addition">+          &quot;defaultConfiguration&quot;: &quot;production&quot;</span></span><br><span class="line">         &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>angular-universal-demo&#x2F;package.json</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">--- a/angular-universal-demo/package.json</span></span><br><span class="line"><span class="comment">+++ b/angular-universal-demo/package.json</span></span><br><span class="line"><span class="meta">@@ -9,7 +9,11 @@</span></span><br><span class="line">     &quot;buildProd&quot;: &quot;ng build --configuration production&quot;,</span><br><span class="line">     &quot;test&quot;: &quot;ng test&quot;,</span><br><span class="line">     &quot;lint&quot;: &quot;ng lint&quot;,</span><br><span class="line"><span class="deletion">-    &quot;e2e&quot;: &quot;ng e2e&quot;</span></span><br><span class="line"><span class="addition">+    &quot;e2e&quot;: &quot;ng e2e&quot;,</span></span><br><span class="line"><span class="addition">+    &quot;dev:ssr&quot;: &quot;ng run angular-universal-demo:serve-ssr&quot;,</span></span><br><span class="line"><span class="addition">+    &quot;serve:ssr&quot;: &quot;node dist/angular-universal-demo/server/main.js&quot;,</span></span><br><span class="line"><span class="addition">+    &quot;build:ssr&quot;: &quot;ng build &amp;&amp; ng run angular-universal-demo:server&quot;,</span></span><br><span class="line"><span class="addition">+    &quot;prerender&quot;: &quot;ng run angular-universal-demo:prerender&quot;</span></span><br><span class="line">   &#125;,</span><br><span class="line">   &quot;private&quot;: true,</span><br><span class="line">   &quot;dependencies&quot;: &#123;</span><br><span class="line"><span class="meta">@@ -18,24 +22,27 @@</span></span><br><span class="line">     &quot;@angular/cdk&quot;: &quot;13.3.1&quot;,</span><br><span class="line">     &quot;@angular/platform-browser-dynamic&quot;: &quot;13.3.1&quot;,</span><br><span class="line"><span class="addition">+    &quot;@angular/platform-server&quot;: &quot;13.3.1&quot;,</span></span><br><span class="line">     &quot;@angular/router&quot;: &quot;13.3.1&quot;,</span><br><span class="line">     &quot;@swimlane/ngx-charts&quot;: &quot;19.1.0&quot;,</span><br><span class="line">     &quot;@swimlane/ngx-datatable&quot;: &quot;20.0.0&quot;,</span><br><span class="line"><span class="addition">+    &quot;@nguniversal/express-engine&quot;: &quot;^13.1.0&quot;,</span></span><br><span class="line">     &quot;@angular/cli&quot;: &quot;13.3.1&quot;,</span><br><span class="line">     &quot;@angular/compiler-cli&quot;: &quot;13.3.1&quot;,</span><br><span class="line">     &quot;@angular/language-service&quot;: &quot;13.3.1&quot;,</span><br><span class="line"><span class="addition">+    &quot;@nguniversal/builders&quot;: &quot;^13.1.0&quot;,</span></span><br><span class="line"><span class="addition">+    &quot;@types/express&quot;: &quot;^4.17.0&quot;,</span></span><br></pre></td></tr></table></figure><p>app.module.ts</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--- a/angular-universal-demo/src/app/app.module.ts</span></span><br><span class="line"><span class="comment">+++ b/angular-universal-demo/src/app/app.module.ts</span></span><br><span class="line"><span class="meta">@@ -33,7 +33,7 @@</span> const DEFAULT_PERFECT_SCROLLBAR_CONFIG: PerfectScrollbarConfigInterface = &#123;</span><br><span class="line"></span><br><span class="line"> @NgModule(&#123;</span><br><span class="line">   imports: [</span><br><span class="line"><span class="deletion">-    BrowserModule,</span></span><br><span class="line"><span class="addition">+    BrowserModule.withServerTransition(&#123; appId: &#x27;serverApp&#x27; &#125;),</span></span><br><span class="line">     BrowserAnimationsModule,</span><br><span class="line">     FormsModule,</span><br><span class="line">     HttpClientModule,</span><br></pre></td></tr></table></figure><blockquote><p>Angular 会把 appId 值（它可以是任何字符串）添加到服务端渲染页面的样式名中，以便在客户端应用启动时可以找到并移除它们。</p></blockquote><p>app.routing.ts</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--- a/angular-universal-demo/src/app/app.routing.ts</span></span><br><span class="line"><span class="comment">+++ b/angular-universal-demo/src/app/app.routing.ts</span></span><br><span class="line"><span class="meta">@@ -19,10 +19,10 @@</span> export const routes: Routes = [</span><br><span class="line"> @NgModule(&#123;</span><br><span class="line">     imports: [</span><br><span class="line">         RouterModule.forRoot(routes, &#123;</span><br><span class="line"><span class="deletion">-            preloadingStrategy: PreloadAllModules,</span></span><br><span class="line"><span class="deletion">-            relativeLinkResolution: &#x27;legacy&#x27;,</span></span><br><span class="line"><span class="deletion">-            // useHash: true</span></span><br><span class="line"><span class="deletion">-        &#125;)</span></span><br><span class="line"><span class="addition">+    preloadingStrategy: PreloadAllModules,</span></span><br><span class="line"><span class="addition">+    relativeLinkResolution: &#x27;legacy&#x27;,</span></span><br><span class="line"><span class="addition">+    initialNavigation: &#x27;enabledBlocking&#x27;</span></span><br><span class="line"><span class="addition">+&#125;)</span></span><br><span class="line">     ],</span><br><span class="line">     exports: [</span><br><span class="line">         RouterModule</span><br></pre></td></tr></table></figure><p>“enabledBlocking”-在创建根组件之前开始初始化导航。引导程序将被 blocked，直到初始导航完成。此值是服务器端渲染工作所必需的。</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">--- a/angular-universal-demo/src/main.ts</span></span><br><span class="line"><span class="comment">+++ b/angular-universal-demo/src/main.ts</span></span><br><span class="line"><span class="meta">@@ -9,5 +9,15 @@</span> if (environment.production) &#123;</span><br><span class="line">   enableProdMode();</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="deletion">-platformBrowserDynamic().bootstrapModule(AppModule)</span></span><br><span class="line"><span class="addition">+function bootstrap() &#123;</span></span><br><span class="line"><span class="addition">+     platformBrowserDynamic().bootstrapModule(AppModule)</span></span><br><span class="line">   .catch(err =&gt; console.error(err));</span><br><span class="line"><span class="addition">+   &#125;;</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+if (document.readyState === &#x27;complete&#x27;) &#123;</span></span><br><span class="line"><span class="addition">+  bootstrap();</span></span><br><span class="line"><span class="addition">+&#125; else &#123;</span></span><br><span class="line"><span class="addition">+  document.addEventListener(&#x27;DOMContentLoaded&#x27;, bootstrap);</span></span><br><span class="line"><span class="addition">+&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="6-开启客户端水合-Client-Hydration"><a href="#6-开启客户端水合-Client-Hydration" class="headerlink" title="6. 开启客户端水合(Client Hydration)"></a>6. 开启客户端水合(Client Hydration)</h2><p>客户端水合是在客户端上恢复服务器端呈现的应用程序的过程。这包括重用服务器呈现的 DOM 结构、持久化应用程序状态、传输服务器已经检索到的应用程序数据以及其他进程。<br>您可以通过修改 app.module.ts 文件来启用水合</p><p>如果是 Angular 11 以上 16 以下的版本, 要达到 Hydration 的效果可参考如下配置, 需要引入 BrowserTransferStateModule.</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BrowserModule</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@angular/platform-browser&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">NgModule</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@angular/core&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppComponent</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./app.component&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BrowserTransferStateModule</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@angular/platform-browser&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NgModule</span>(&#123;</span><br><span class="line">  <span class="attr">declarations</span>: [<span class="title class_">AppComponent</span>],</span><br><span class="line">  <span class="attr">imports</span>: [</span><br><span class="line">    <span class="title class_">BrowserModule</span>.<span class="title function_">withServerTransition</span>(&#123; <span class="attr">appId</span>: <span class="string">&quot;serverApp&quot;</span> &#125;),</span><br><span class="line">    <span class="title class_">BrowserTransferStateModule</span>,</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">bootstrap</span>: [<span class="title class_">AppComponent</span>],</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AppModule</span> &#123;&#125;</span><br></pre></td></tr></table></figure><p>如果 Angular 16 为了达到 Hydration 的效果, 可以参考如下配置:<br>。从@angular&#x2F;platform-browser 导入 provideClientHydration 函数，并将函数调用添加到 AppModule 的 providers 部分，如下所示。</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; provideClientHydration &#125; <span class="keyword">from</span> <span class="string">&quot;@angular/platform-browser&quot;</span>;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@NgModule</span>(&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">providers</span>: [<span class="title function_">provideClientHydration</span>()], <span class="comment">// add this line</span></span><br><span class="line">  <span class="attr">bootstrap</span>: [<span class="title class_">AppComponent</span>],</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AppModule</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>更新: 2023&#x2F;11&#x2F;10</p><p>即使升级到 Angular 15, 16 以后, 如果使用的是 NgModule 的方式引导启动应用程序, 本教程还是完全适用的.</p><p>另外 Angular 15 对 以 standalone component 启动应用并且开启 ssr 的支持没有 16 完善, 在条件许可的情况下建议升级完 15 后接着升级到 16, 如果坚持使用 15 的话, 建议不要使用 standalone component 来引导应用程序, 到 16 以后就可以放心大胆使用 standalone component 来启动应用了.</p><p>在 Angular 15, 16 中, 如果使用的是 Angular standalone component 引导启动应用程序, 以下三个文件 server.ts, src&#x2F;main.server.ts, app.config.server.ts 的写法是跟本教程稍有不同, 为了不破坏文档的结构, 也避免制造一些混乱, 这里不将这种配置上差异列举出来了. 具体差异可以结合 github 上的一个示例<a target="_blank" rel="noopener" href="https://github.com/brandonroberts/angular-v16-universal-standalone">angular-v16-universal-standalone</a>, 参考本文档, 可以解决大部分的问题.</p><h2 id="7-使用-Universal-构建和运行"><a href="#7-使用-Universal-构建和运行" class="headerlink" title="7. 使用 Universal 构建和运行"></a>7. 使用 Universal 构建和运行</h2><p>构建 SSR</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build:ssr</span><br></pre></td></tr></table></figure><p>构建完应用之后，启动服务器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run serve:ssr</span><br></pre></td></tr></table></figure><p>或者构建同时启动服务器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run dev:ssr</span><br></pre></td></tr></table></figure><h2 id="8-Prerender-预渲染静态-HTML"><a href="#8-Prerender-预渲染静态-HTML" class="headerlink" title="8. Prerender 预渲染静态 HTML"></a>8. Prerender 预渲染静态 HTML</h2><p>经过上面的步骤后，如果我们通过<code>npm run build:ssr</code> 构建项目，你会发现在 <code>dist/&lt;your project&gt;/browser</code> 下面只有 index.html 文件，打开文件查看，发现其中还有 <code>&lt;app-root&gt;&lt;/app-root&gt;</code> 这样的元素，也就是说你的网页内容并没有在 html 中生成。这是因为 Angular 使用了动态路由，比如 &#x2F;product&#x2F;:id 这种路由，而页面的渲染结果要经过 JS 的执行才能知道，因此，Angular 使用了 Express 作为 Web 服务器，能在服务端运行时根据用户请求（爬虫请求）使用模板引擎生成静态 HTML 界面。</p><p>而 prerender（npm run prerender）会在构建时生成静态 HTML 文件。比如我们做企业官网，只有几个页面，那么我们可以使用预渲染技术生成这几个页面的静态 HTML 文件，避免在运行时动态生成，从而进一步提升网页的访问速度和用户体验。</p><h3 id="8-1-预渲染路径配置"><a href="#8-1-预渲染路径配置" class="headerlink" title="8.1. 预渲染路径配置"></a>8.1. 预渲染路径配置</h3><p>需要进行预渲染（预编译 HTML）的网页路径，可以有几种方式进行提供：</p><ol><li>通过命令行的附加参数:</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ng run &lt;app-name&gt;:prerender --routes /product/1 /product/2</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>这里有个需要注意的地方, 即使我只指定了两个路径, Angular universal 还是会使用 guess-parser 解析 routes 猜测可能的路径帮助渲染一堆路径, 实际上这种猜测有些鸡肋, 根本不会准确, 没有太大帮助. 此时可以使用 –no-guess-routes 选项将其关闭.</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ng run &lt;app-name&gt;:prerender --no-guess-routes --routes /product/1 /product/2</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>或者修改 angular.json, 将 guessRoutes 设置为 false</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;prerender&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;builder&quot;</span><span class="punctuation">:</span> <span class="string">&quot;@nguniversal/builders:prerender&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;routes&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;/product/1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;/product/2&quot;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;guessRoutes&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><ol><li>如果路径比较多，比如针对 product&#x2F;:id 这种动态路径，则可以使用一个路径文件：</li></ol><p>routes.txt</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/products/1</span><br><span class="line">/products/23</span><br><span class="line">/products/145</span><br><span class="line">/products/555</span><br></pre></td></tr></table></figure><p>然后在命令行参数指定该文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ng run &lt;app-name&gt;:prerender --routes-file routes.txt</span><br></pre></td></tr></table></figure><p>或者在 angular.json 中指定 routes-file</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="attr">&quot;prerender&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;builder&quot;</span><span class="punctuation">:</span> <span class="string">&quot;@nguniversal/builders:prerender&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;guessRoutes&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;routesFile&quot;</span><span class="punctuation">:</span> <span class="string">&quot;routes-to-prerender.txt&quot;</span> <span class="comment">// 在这里指定routes-file</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure><ol start="3"><li>在项目的 angular.json 文件配置需要的路径</li></ol><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;prerender&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;builder&quot;</span><span class="punctuation">:</span> <span class="string">&quot;@nguniversal/builders:prerender&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;routes&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span> <span class="comment">// 这里配置</span></span><br><span class="line">      <span class="string">&quot;/&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;/main/home&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;/main/service&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;/main/team&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;/main/contact&quot;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure><p>配置完成后，重新执行预渲染命令（npm run prerender 或者使用命令行参数则按照上面&lt;1&gt;&lt;2&gt;中的命令执行），编译完成后，再打开 <code>dist/&lt;your project&gt;/browser</code> 下的 index.html 会发现里面没有 <code>&lt;app-root&gt;&lt;/app-root&gt;</code> 了，取而代之的是主页的实际内容。同时也生成了相应的路径目录以及各个目录下的 index.html 子页面文件。</p><h2 id="9-SEO-优化"><a href="#9-SEO-优化" class="headerlink" title="9. SEO 优化"></a>9. SEO 优化</h2><h3 id="9-1-关键词与描述的优化"><a href="#9-1-关键词与描述的优化" class="headerlink" title="9.1. 关键词与描述的优化"></a>9.1. 关键词与描述的优化</h3><p>SEO 的关键在于对网页 title，keywords 和 description 的收录，因此对于我们想要让搜索引擎收录的网页，可以修改代码提供这些内容。</p><p>在 Angular 14 中，如果路由界面通过 Routes 配置，可以将网页的静态 title 直接写在路由的配置中：</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="attr">path</span>: <span class="string">&#x27;home&#x27;</span>, <span class="attr">component</span>: <span class="title class_">AbmHomeComponent</span>, <span class="attr">title</span>: <span class="string">&#x27;&lt;你想显示在浏览器 tab 上的标题&gt;&#x27;</span> &#125;,</span><br></pre></td></tr></table></figure><p>另外，Angular 也提供了可注入的 Title 和 Meta 用于修改网页的标题和 meta 信息：</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Meta</span>, <span class="title class_">Title</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@angular/platform-browser&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">ExampleComponent</span> <span class="keyword">implements</span> <span class="title class_">OnInit</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="keyword">private</span> <span class="attr">_title</span>: <span class="title class_">Title</span>, <span class="keyword">private</span> <span class="attr">_meta</span>: <span class="title class_">Meta</span></span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">ngOnInit</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_title</span>.<span class="title function_">setTitle</span>(<span class="string">&quot;&lt;此页的标题&gt;&quot;</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_meta</span>.<span class="title function_">addTags</span>([</span><br><span class="line">      &#123; <span class="attr">name</span>: <span class="string">&quot;keywords&quot;</span>, <span class="attr">content</span>: <span class="string">&quot;&lt;此页的 keywords，以英文逗号隔开&gt;&quot;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">name</span>: <span class="string">&quot;description&quot;</span>, <span class="attr">content</span>: <span class="string">&quot;&lt;此页的描述&gt;&quot;</span> &#125;,</span><br><span class="line">    ]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="9-2-内部跳转优化"><a href="#9-2-内部跳转优化" class="headerlink" title="9.2. 内部跳转优化"></a>9.2. 内部跳转优化</h3><p>这个是指应用内部页面跳转尽量使用 a 标签，而不是使用别的标签加(click)事件进行跳转。</p><h3 id="9-3-样式文件打包"><a href="#9-3-样式文件打包" class="headerlink" title="9.3. 样式文件打包"></a>9.3. 样式文件打包</h3><p>另外一个需要注意的地方是，如果网站的样式很多很复杂，那么网站发布的时候 angular.json 中 extractCss 需要设置为 true,即单独打包一个独立的样式文件，而不是将样式全部包含在发布后的 index.html 中。</p><p>全部包含在 index.html 中会造成抓取保存的静态 html 文件过大，百度不能正确保存快照（百度限制了缓存文件大小，好像是 100k）。</p><h3 id="9-4-添加-robots-txt"><a href="#9-4-添加-robots-txt" class="headerlink" title="9.4. 添加 robots.txt"></a>9.4. 添加 robots.txt</h3><p>在网站优化过程中，有些时候，网站中有重要及私密的内容，站长并不希望某些页面被蜘蛛抓取，比如后台的数据，测试阶段的网站，还有一种很常见的情况，搜索引擎抓取的大量没有意义的页面。</p><p>robots.txt 是一个纯文本文件，用于声明该网站中不想被蜘蛛访问的部分，或指定蜘蛛抓取的部分，当蜘蛛访问一个站点时，它会首先检查该站点是否存在，robots.txt，如果找到，蜘蛛就会按照该文件中的内容来确定抓取的范围，如果该文件不存在，那么蜘蛛就会沿着链接直接抓取。即，只有在需要禁止抓取某些内容是，写 robots.txt 才有意义.</p><p>robots 配置方法如下：</p><ul><li>在 project_root&#x2F;src 路径下创建 robots.txt 文件，里面输入你的 robots 配置，如果不懂，可以百度 robots 的语法，修改后保存即可提交。</li></ul><p>下面是一个简单的 robots.txt 的例子</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow:</span><br><span class="line">Sitemap: http://your_domain/sitemap.xml</span><br></pre></td></tr></table></figure><p>还需要修改 angular.json 文件, 这样 robots.txt 文件才能被访问到</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   ......</span><br><span class="line">   <span class="attr">&quot;assets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">     <span class="string">&quot;src/favicon.ico&quot;</span><span class="punctuation">,</span></span><br><span class="line">     <span class="string">&quot;src/robots.txt&quot;</span><span class="punctuation">,</span></span><br><span class="line">     <span class="string">&quot;src/sitemap.xml&quot;</span><span class="punctuation">,</span></span><br><span class="line">     <span class="string">&quot;src/assets&quot;</span></span><br><span class="line">   <span class="punctuation">]</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure><h3 id="9-5-自动生成-sitemap"><a href="#9-5-自动生成-sitemap" class="headerlink" title="9.5. 自动生成 sitemap"></a>9.5. 自动生成 sitemap</h3><p>安装工具 ngx-sitemap</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install ngx-sitemap --save-dev</span><br></pre></td></tr></table></figure><p>在 prerendering 后运行以下命令, 就可以生成 sitemap.xml</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$./node_modules/.bin/ngx-sitemap ./dist/angular-universal-demo/browser htts://your_domain</span><br><span class="line">sitemap.xml successfully created <span class="keyword">in</span> <span class="string">&#x27;./dist/angular-universal-demo/browser/&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="10-使用-Nginx-部署"><a href="#10-使用-Nginx-部署" class="headerlink" title="10. 使用 Nginx 部署"></a>10. 使用 Nginx 部署</h2><p>整个 topo 结构是这样的, 首先要使用 pm2 将服务器端渲染程序运行起来, 然后通过 Nginx 将请求反向代理到 pm2.</p><p>这样 PM2 就会实际处理所有请求, 对于已经 prerender 过的页面 PM2 会直接去 browser 文件夹中去取, 对于没有 prerender 的页面, 首先会在服务器端渲染然后传送到浏览器端.<br>页面到达流量器端后, 首先页面有一个基本的静态呈现, 与此同时会继续向后端请求 javascript, 直到 javascript 下载完成后, 将会进行 CSR(客户端渲染), 如果没有使用到 hydration 技术, 此时页面会有一个比较明显的闪烁, 如果使用了 hydration 技术此时会 CSR 渲染会比较平滑地替代 SSR 渲染的页面, 除了页面被重新渲染以外, 前端路由也会被 javascript 接管. 此时如果用户不刷新页面, 整个应用就运行在 SPA 模式下了.</p><p>对于搜索引擎爬虫, 由于它只读取页面文本内容, 不会去执行 javascript 代码, 所以相对于浏览器访问, 爬虫只是爬取那一页的内容, 不会有 javascript 下载过程, 更不会有 CSR, 以及 hydration 的过程.</p><p>整个部署过程是这样的, 首先安装 Nginx, node 以及 PM2. 然后启动 PM2, Nginx 反向代理到 PM2.</p><h3 id="10-1-安装-Nginx"><a href="#10-1-安装-Nginx" class="headerlink" title="10.1. 安装 Nginx"></a>10.1. 安装 Nginx</h3><p>参考我的博客 <a target="_blank" rel="noopener" href="https://www.pengtech.net/nginx/nginx_installation.html">鹏叔的技术博客-nginx 安装教程</a></p><h3 id="10-2-安装-Node"><a href="#10-2-安装-Node" class="headerlink" title="10.2. 安装 Node"></a>10.2. 安装 Node</h3><p>安装 Nodejs 可以参考博客 <a target="_blank" rel="noopener" href="https://www.pengtech.net/nodejs/install_and_config_nodejs.html">安装并配置 nodejs | 鹏叔的技术博客</a></p><h3 id="10-3-安装-PM2"><a href="#10-3-安装-PM2" class="headerlink" title="10.3. 安装 PM2"></a>10.3. 安装 PM2</h3><p>安装 pm2 来支持 SSR</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装pm2</span></span><br><span class="line">npm install -g pm2</span><br><span class="line"><span class="comment"># 查看pm2版本</span></span><br><span class="line">pm2 --v</span><br><span class="line"><span class="comment"># 5.3.0</span></span><br></pre></td></tr></table></figure><h3 id="10-4-配置并启动-pm2"><a href="#10-4-配置并启动-pm2" class="headerlink" title="10.4. 配置并启动 pm2"></a>10.4. 配置并启动 pm2</h3><p>为了能在任意位置都能执行 pm2, 我们将 pm2 添加到 PATH 下, 添加的方法是在&#x2F;usr&#x2F;bin 下创建一个软连接</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">ln</span> -s /usr/local/node-v14.17.5-linux-x64/lib/node_modules/pm2/bin/pm2 /usr/bin/pm2</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>我们顺便查看一下 pm2 的版本并确保软连接创建有效</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pm2 --version</span><br><span class="line">[PM2] Spawning PM2 daemon with pm2_home=/root/.pm2</span><br><span class="line">[PM2] PM2 Successfully daemonized</span><br><span class="line">5.3.0</span><br></pre></td></tr></table></figure><p>接下来, 我们就可以使用 PM2 启动服务器端渲染了,<br>这里我们假设已经将程序部署到了服务器的&#x2F;var&#x2F;your_app&#x2F;webapp 目录, 结构如下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tree -L 1 /var/your_app/webapp</span><br><span class="line">/var/your_app/webapp</span><br><span class="line">├── browser</span><br><span class="line">└── server</span><br></pre></td></tr></table></figure><p>启动 SSR</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">pm2 start --name app_ssr /var/your_app/webapp/server/main.js</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>注意: 使用 angular cli 默认生成的 distFolder 部署到服务器, 会出现 index 文件找不到.<br>这里可以修改以下让其相对于 main.js 查找 index 而不是 process.cwd()</p></blockquote><p>vi server.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">parentFolder</span>: <span class="built_in">string</span> = <span class="title function_">join</span>(__dirname, <span class="string">&quot;../&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="attr">distFolder</span>: <span class="built_in">string</span> = <span class="title function_">join</span>(parentFolder, <span class="string">&quot;browser&quot;</span>);</span><br></pre></td></tr></table></figure><p>设置开机自启动</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 保存要在机器重新启动时重新生成的列表</span></span><br><span class="line">pm2 save</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成开机自启动服务</span></span><br><span class="line">pm2 startup</span><br><span class="line"></span><br><span class="line"><span class="comment"># enable pm2开机自启</span></span><br><span class="line">systemctl <span class="built_in">enable</span> pm2-root</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>另外一些有用的 pm2 命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看进程</span></span><br><span class="line">pm2 list</span><br><span class="line"><span class="comment"># 关闭prcess</span></span><br><span class="line">pm2 stop process_name</span><br><span class="line"><span class="comment"># 删除进程</span></span><br><span class="line">pm2 delete process_name</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看process 详情</span></span><br><span class="line">pm2 show process_name</span><br></pre></td></tr></table></figure><p>至此 PM2 配置完成, ssr 默认会监听在 4000 端口, 可以通过如下命令查找端口号</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="string">&quot;process.env\[\&quot;PORT\&quot;\]&quot;</span> /var/your_app/webapp/server/main.js</span><br></pre></td></tr></table></figure><p>其他一些有用的 pm2 命令</p><p>查看日志某个任务的日志</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">pm2 <span class="built_in">log</span> the_process_name</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="10-5-配置-Nginx-反向代理"><a href="#10-5-配置-Nginx-反向代理" class="headerlink" title="10.5. 配置 Nginx 反向代理"></a>10.5. 配置 Nginx 反向代理</h3><p>修改&#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;defaut.conf 将之前的配置由如下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">location / &#123;</span><br><span class="line">        root   /var/your_app/webapp/;</span><br><span class="line">        index  index.html index.htm;</span><br><span class="line">        try_files $uri $uri/ /index.html;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>改成</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">location / &#123;</span><br><span class="line">       proxy_set_header Host $host;</span><br><span class="line">       proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">       proxy_pass http://127.0.0.1:4000/;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="11-troubleshooting"><a href="#11-troubleshooting" class="headerlink" title="11. troubleshooting"></a>11. troubleshooting</h2><h3 id="11-1-问题-1-Configuration-‘development’-is-not-set-in-the-workspace"><a href="#11-1-问题-1-Configuration-‘development’-is-not-set-in-the-workspace" class="headerlink" title="11.1. 问题 1: Configuration ‘development’ is not set in the workspace"></a>11.1. 问题 1: Configuration ‘development’ is not set in the workspace</h3><p>描述: 当执行<code>npm run dev:ssr</code> 系统抛出如下错误 Configuration ‘development’ is not set in the workspace.</p><p>原因: 原因实际上是一个 bug, Angular 开发人员未考虑到, 我们的配置于他们期望的有差异.<br>详细原因和解决方案请参考<a target="_blank" rel="noopener" href="https://github.com/angular/angular-cli/issues/18428">this issue</a><br>也请注意, 我贴出来的<code>ng add @nguniversal/express-engine</code>自动配置的 angular.json 的 serve-ssr 部分是有修改过的, 目的就是为了解决这个问题.</p><h3 id="11-2-问题-2-ReferenceError-window-is-not-defined"><a href="#11-2-问题-2-ReferenceError-window-is-not-defined" class="headerlink" title="11.2. 问题 2: ReferenceError: window is not defined"></a>11.2. 问题 2: ReferenceError: window is not defined</h3><p>描述: 当执行’npm run dev:ssr’ 系统抛出如下错误 ReferenceError: window is not defined</p><p>原因: 问题的原因是在 Nodejs 运行时, 没有 window, document, navigator 等等浏览器端对象.</p><p>可以参考我的博客<a target="_blank" rel="noopener" href="https://www.pengtech.net/angular/consideration_on_angular_universal.html">使用 Angular Universal 时的重要注意事项</a>,<br>里面提到了三种解决该问题的策略, 这里我选择了 策略 3：Shims, 相应的修改如下:</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">import &#x27;zone.js/dist/zone-node&#x27;;</span><br><span class="line"> import &#123; join &#125; from &#x27;path&#x27;;</span><br><span class="line"><span class="deletion">-</span></span><br><span class="line"><span class="addition">+import &quot;localstorage-polyfill&quot;;</span></span><br><span class="line"> import &#123; AppServerModule &#125; from &#x27;./src/main.server&#x27;;</span><br><span class="line"> import &#123; APP_BASE_HREF &#125; from &#x27;@angular/common&#x27;;</span><br><span class="line"><span class="deletion">-import &#123; existsSync &#125; from &#x27;fs&#x27;;</span></span><br><span class="line"><span class="deletion">-</span></span><br><span class="line"><span class="addition">+import &#123; existsSync,readFileSync &#125; from &#x27;fs&#x27;;</span></span><br><span class="line"><span class="addition">+import &#123; createWindow &#125; from &quot;domino&quot;;</span></span><br><span class="line"> // The Express app is exported so that it can be used by serverless Functions.</span><br><span class="line"> export function app(): express.Express &#123;</span><br><span class="line">   const server = express();</span><br><span class="line">   const distFolder = join(process.cwd(), &#x27;dist/angular-universal-demo/browser&#x27;);</span><br><span class="line">   const indexHtml = existsSync(join(distFolder, &#x27;index.original.html&#x27;)) ? &#x27;index.original.html&#x27; : &#x27;index&#x27;;</span><br><span class="line"></span><br><span class="line"><span class="addition">+  applyDomino(indexHtml)</span></span><br><span class="line">   // Our Universal express-engine (found @ https://github.com/angular/universal/tree/master/modules/express-engine)</span><br><span class="line">   server.engine(&#x27;html&#x27;, ngExpressEngine(&#123;</span><br><span class="line">     bootstrap: AppServerModule,</span><br><span class="line">   &#125;));</span><br><span class="line"></span><br><span class="line"><span class="meta">@@ -35,26 +36,41 @@</span> export function app(): express.Express &#123;</span><br><span class="line">   &#125;);</span><br><span class="line"></span><br><span class="line">   return server;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="addition">+function applyDomino(indexHtml: string): void &#123;</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+  const win = createWindow(indexHtml)</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+  console.log(&quot;applying mock window &quot;)</span></span><br><span class="line"><span class="addition">+  global[&quot;localStorage&quot;] = localStorage;</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+  // Polyfills</span></span><br><span class="line"><span class="addition">+  (global as any).window = win;</span></span><br><span class="line"><span class="addition">+  (global as any).document = win.document;</span></span><br><span class="line"><span class="addition">+  (global as any).navigator = win.navigator;</span></span><br><span class="line"><span class="addition">+  (global as any).location = win.location;</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+&#125;</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="11-3-问题-3-Flex-Layout-loaded-on-the-server-without-FlexLayoutServerModule"><a href="#11-3-问题-3-Flex-Layout-loaded-on-the-server-without-FlexLayoutServerModule" class="headerlink" title="11.3. 问题 3: Flex Layout loaded on the server without FlexLayoutServerModule"></a>11.3. 问题 3: Flex Layout loaded on the server without FlexLayoutServerModule</h3><p>描述: 当执行<code>npm run dev:ssr</code> 或者 <code>npm run prerender</code>时, 频繁的输出警告 Warning: Flex Layout loaded on the server without FlexLayoutServerModule</p><p>原因分析: FlexLayout 需要在 js 运行时确定屏幕大小等等信息, 在 server side 由于没有 screen 的概念所以需要模拟浏览器端的行为, FlexLayout 专门为 ssr 提供了一套 Module 来模拟浏览器端的行为, 所以最好在服务器端程序引入 FlexLayoutServerModule, 也即在 app.server.module.ts 中引入 FlexLayoutServerModule</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//app.server.module.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">NgModule</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">FlexLayoutServerModule</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/flex-layout/server&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NgModule</span>(&#123;</span><br><span class="line">  <span class="attr">imports</span>: [</span><br><span class="line">    ... other imports here</span><br><span class="line">    <span class="title class_">FlexLayoutServerModule</span>,</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>以及定义在 SSR 配置渲染时模拟的屏幕大小, 修改 app.module.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//app.module.ts to simulate breakpoints</span></span><br><span class="line"><span class="meta">@NgModule</span>(&#123;</span><br><span class="line">  <span class="attr">imports</span>: [</span><br><span class="line">  ... other imports here</span><br><span class="line">  <span class="title class_">FlexLayoutModule</span>.<span class="title function_">withConfig</span>(&#123;<span class="attr">ssrObserveBreakpoints</span>: [<span class="string">&#x27;xs&#x27;</span>, <span class="string">&#x27;lt-md&#x27;</span>]&#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="11-4-问题-4-XMLHttpRequest-is-not-defined"><a href="#11-4-问题-4-XMLHttpRequest-is-not-defined" class="headerlink" title="11.4. 问题 4: XMLHttpRequest is not defined"></a>11.4. 问题 4: XMLHttpRequest is not defined</h3><p>描述: 当执行<code>npm run dev:ssr</code> 或者 <code>npm run prerender</code>时, 系统抛出如下错误 ReferenceError: XMLHttpRequest is not defined</p><p>原因分析: 原因是我的代码中调用了 ajax 这个 rxjs operator <code>import &#123; ajax, AjaxResponse &#125; from &#39;rxjs/ajax&#39;;</code>其底层实现需要 XMLHttpRequest,<br>而在 Sever side javascript 环境中没有引入 xmlhttprequest 这个包.</p><p>解决办法: 解决办法可以有多种, 我选择了将 ajax 这个 rxjs operator 全部替换成了 HttpClient call, 例如</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">concatMap</span>(<span class="function">(<span class="params"><span class="attr">remoteServerUri</span>: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> headers = <span class="keyword">new</span> <span class="title class_">HttpHeaders</span>(&#123;</span><br><span class="line">          <span class="title class_">Authorization</span>: <span class="string">&quot;Basic &quot;</span> + idToken,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">httpClient</span>.<span class="property">get</span>&lt;<span class="built_in">any</span>&gt;(remoteServerUri + url, &#123; <span class="attr">headers</span>: headers &#125;);</span><br><span class="line">      &#125;),</span><br></pre></td></tr></table></figure><p>参考文章 <a target="_blank" rel="noopener" href="https://github.com/angular/universal/issues/1835">How to resolve window is not defined on npm run serve:ssr</a></p><h3 id="11-5-问题-5：-dist-demo-web-browser-ReferenceError-Image-is-not-defined"><a href="#11-5-问题-5：-dist-demo-web-browser-ReferenceError-Image-is-not-defined" class="headerlink" title="11.5. 问题 5： \dist\demo-web\browser...ReferenceError: Image is not defined"></a>11.5. 问题 5： <code>\dist\demo-web\browser...ReferenceError: Image is not defined</code></h3><p>问题分析：</p><p>当页面使用 const bookImage &#x3D; new Image(); 的时候， 在 server side rendering 时报如题错误。问题的原因是由于代码运行在 nodejs 运行时环境，而不是浏览器环境。正如我的博客<a target="_blank" rel="noopener" href="https://www.pengtech.net/angular/consideration_on_angular_universal.html">使用 Angular Universal 时的重要注意事项</a>中所提到的，服务器上不存在或不支持某些功能 Canvas，image 等对象.</p><p>三次尝试：第三次成功</p><ol><li>即使我尝试使用<code>const bookImage = this.document.createElement(&#39;img&#39;);</code> 尝试使用 domino 的 document 对象的实现方式， 仍然遇到<code>dist\demo-web\browser...Error: NotYetImplemented</code>的错误。虽然这是由于 domino 仍然没有实现创建 image 对象的方法。</li></ol><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="title function_">constructor</span>(<span class="params"><span class="meta">@Inject</span>(DOCUMENT) <span class="keyword">private</span> <span class="attr">document</span>: <span class="title class_">Document</span></span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">ngAfterViewInit</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> bookImage = <span class="variable language_">this</span>.<span class="property">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;img&#x27;</span>);</span><br><span class="line">    bookImage.<span class="property">src</span> = <span class="string">&#x27;assets/img/wb/cover_template.png&#x27;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">ctx</span> = <span class="variable language_">this</span>.<span class="property">wbCoverCanvas</span>?.<span class="property">nativeElement</span>.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>)</span><br><span class="line">    bookImage.<span class="property">onload</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">drawCover</span>(bookImage)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="2"><li>后来尝试使用 canvas nodejs 包<code>npm install canvas</code>， 依然出现错误。参考问题<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/56306205/referenceerror-image-is-not-defined">ReferenceError: Image is not defined</a>，<a target="_blank" rel="noopener" href="https://github.com/Automattic/node-canvas">node-canvas</a>，仍然报错<code>node_modules/canvas/types/index.d.ts:3:26 - error TS2307: Cannot find module &#39;stream&#39; or its corresponding type declarations.</code></li></ol><p>尝试解决以上错误，还是遇到很多问题。</p><ol><li><p>最终还是回到 <a target="_blank" rel="noopener" href="https://www.pengtech.net/angular/consideration_on_angular_universal.html">使用 Angular Universal 时的重要注意事项</a>中所提到的办法 - 策略 2：Guard</p><p>将 drawCover 抽取到一个 service 中， 当运行 server 端代码时， 专门针对 server side 注入不同的 canvas service， 跳过 canvas 创建，这样并不会影响用户体验， 当客户端水合过程中毕竟会重绘 canvas.</p></li></ol><h2 id="12-相关阅读"><a href="#12-相关阅读" class="headerlink" title="12. 相关阅读"></a>12. 相关阅读</h2><p>本技术博客原创文章位于<a target="_blank" rel="noopener" href="https://www.pengtech.net/angular/angular_universal">Angular universal 服务器端渲染与预渲染 | 鹏叔的技术博客</a>, 要获取最近更新请访问原文.</p><p>更多 Angular 相关文章请访问<a target="_blank" rel="noopener" href="https://www.pengtech.net/angular/">Angular 合集 | 鹏叔的技术博客</a></p><p>更多技术博客请访问: <a target="_blank" rel="noopener" href="https://www.pengtech.net/archives/">鹏叔的技术博客</a></p><h2 id="13-参考文档"><a href="#13-参考文档" class="headerlink" title="13. 参考文档"></a>13. 参考文档</h2><p><a target="_blank" rel="noopener" href="https://angular.io/guide/universal">Server-side rendering (SSR) with Angular Universal</a></p><p><a target="_blank" rel="noopener" href="https://github.com/angular/universal/blob/master/docs/gotchas.md">Important Considerations when Using Angular Universal</a></p><p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000041753539">2022 前端性能优化最佳实践</a></p><p><a target="_blank" rel="noopener" href="https://www.pengtech.net/angular/consideration_on_angular_universal.html">使用 Angular Universal 时的重要注意事项</a></p><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/RJ0024/article/details/110490912">Angular 服务器渲染常遇的坑</a></p><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/jmix/p/angular_ssr_seo.html">Angular SSR 探究</a></p><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_38391672/article/details/98471035">Angular 7 SSR 之后使用 node + nginx 部署在 linux</a></p><p><a target="_blank" rel="noopener" href="https://github.com/angular/angular/issues/21471">Better Approach for Styles for SSR (Angular Universal)</a></p><p><a target="_blank" rel="noopener" href="https://github.com/angular/angular/issues/14914">Feature Request: ability to produce and load CSS via link tag in index.html</a></p><p><a target="_blank" rel="noopener" href="https://github.com/brandonroberts/angular-v16-universal-standalone">angular-v16-universal-standalone</a></p></div><div class="article-licensing box"><div class="licensing-title"><p>Angular universal服务器端渲染与预渲染</p><p><a href="https://pengtech.net/angular/angular_universal.html">https://pengtech.net/angular/angular_universal.html</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>鹏叔</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2023-05-03</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2024-07-10</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/javascript/">javascript</a><a class="link-muted mr-2" rel="tag" href="/tags/Angular/">Angular</a><a class="link-muted mr-2" rel="tag" href="/tags/SEO/">SEO</a></div><div class="sharethis-inline-share-buttons"></div><script src="https://platform-api.sharethis.com/js/sharethis.js#property=668dd7bacc04fc0019b762dc&amp;product=inline-share-buttons" defer></script></article></div><div class="card"><nav class="post-navigation mt-4 level is-mobile card-content"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/angular/consideration_on_angular_universal.html"><i class="level-item fas fa-chevron-left"></i><span class="level-item">使用Angular Universal时的重要注意事项</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/network/frp_install.html"><span class="level-item">frp内网穿透</span><i class="level-item fas fa-chevron-right"></i></a></div></nav></div><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><script src="https://utteranc.es/client.js" repo="guoapeng/guoapeng.github.io" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.png" alt="鹏叔的技术博客"></figure><p class="title is-size-4 is-block" style="line-height:inherit">鹏叔的技术博客</p><p class="is-size-6 is-block">日拱一卒，功不唐捐!</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Earth, Solar System, Galaxy.</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">253</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">52</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">80</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/guoapeng" target="_blank" rel="me noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Github" href="https://github.com/guoapeng"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Mail" href="mailto:guoapeng@gmail.com"><i class="fas fa-envelope"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="https://api.follow.it/subscription-form/WmRzSTRLOENhYXVqeVBHRTVyT2wrR0hrdDhDL0JIWDBBNmovOUJXRE1oZExjV1haM0c3cGxHNlhBV3NvQkFOVC9INHF6aGZlUGpwTzcrTGFDRnZEL3NQck9IYzFiYkxiTVVTb2hnL1VaVmJKY09VTHVpbnVBYjJEVXQwNGZMN3R8cWhjVW1qVStTNlBWWGpMM1UydWpHOUNMcGUzbS9PcHgrZEI1UWpqckZYRT0=/8" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="订阅"></div></div></form></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">友情链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://philoenglish.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">菲利英语</span></span><span class="level-right"><span class="level-item tag">philoenglish.com</span></span></a></li><li><a class="level is-mobile" href="https://ngrevive.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Angular复兴</span></span><span class="level-right"><span class="level-item tag">ngrevive.com</span></span></a></li></ul></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/AI/"><span class="level-start"><span class="level-item">AI</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/OS/"><span class="level-start"><span class="level-item">OS</span></span><span class="level-end"><span class="level-item tag">44</span></span></a><ul><li><a class="level is-mobile" href="/categories/OS/android/"><span class="level-start"><span class="level-item">android</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/OS/linux/"><span class="level-start"><span class="level-item">linux</span></span><span class="level-end"><span class="level-item tag">37</span></span></a></li><li><a class="level is-mobile" href="/categories/OS/windows/"><span class="level-start"><span class="level-item">windows</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/database/"><span class="level-start"><span class="level-item">database</span></span><span class="level-end"><span class="level-item tag">8</span></span></a><ul><li><a class="level is-mobile" href="/categories/database/mariadb/"><span class="level-start"><span class="level-item">mariadb</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/database/postgresql/"><span class="level-start"><span class="level-item">postgresql</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/devops/"><span class="level-start"><span class="level-item">devops</span></span><span class="level-end"><span class="level-item tag">20</span></span></a><ul><li><a class="level is-mobile" href="/categories/devops/ansible/"><span class="level-start"><span class="level-item">ansible</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/devops/docker/"><span class="level-start"><span class="level-item">docker</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/devops/frontend/"><span class="level-start"><span class="level-item">frontend</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/devops/frontend/backend/"><span class="level-start"><span class="level-item">backend</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/devops/gitlab/"><span class="level-start"><span class="level-item">gitlab</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/categories/devops/k8s/"><span class="level-start"><span class="level-item">k8s</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/language/"><span class="level-start"><span class="level-item">language</span></span><span class="level-end"><span class="level-item tag">17</span></span></a><ul><li><a class="level is-mobile" href="/categories/language/golang/"><span class="level-start"><span class="level-item">golang</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/categories/language/java/"><span class="level-start"><span class="level-item">java</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/language/rust/"><span class="level-start"><span class="level-item">rust</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/language/typescript/"><span class="level-start"><span class="level-item">typescript</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/network/"><span class="level-start"><span class="level-item">network</span></span><span class="level-end"><span class="level-item tag">7</span></span></a><ul><li><a class="level is-mobile" href="/categories/network/dns/"><span class="level-start"><span class="level-item">dns</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/network/frp/"><span class="level-start"><span class="level-item">frp</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/network/v2rayA/"><span class="level-start"><span class="level-item">v2rayA</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/network/v2rayN/"><span class="level-start"><span class="level-item">v2rayN</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/network/v2rayNG/"><span class="level-start"><span class="level-item">v2rayNG</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/network/vpn/"><span class="level-start"><span class="level-item">vpn</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/others/"><span class="level-start"><span class="level-item">others</span></span><span class="level-end"><span class="level-item tag">6</span></span></a><ul><li><a class="level is-mobile" href="/categories/others/English/"><span class="level-start"><span class="level-item">English</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/others/marketing/"><span class="level-start"><span class="level-item">marketing</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/others/movies/"><span class="level-start"><span class="level-item">movies</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/tools/"><span class="level-start"><span class="level-item">tools</span></span><span class="level-end"><span class="level-item tag">15</span></span></a><ul><li><a class="level is-mobile" href="/categories/tools/git/"><span class="level-start"><span class="level-item">git</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/tools/hexo/"><span class="level-start"><span class="level-item">hexo</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/categories/tools/maven/"><span class="level-start"><span class="level-item">maven</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/tools/vscode/"><span class="level-start"><span class="level-item">vscode</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/web/"><span class="level-start"><span class="level-item">web</span></span><span class="level-end"><span class="level-item tag">133</span></span></a><ul><li><a class="level is-mobile" href="/categories/web/CMS/"><span class="level-start"><span class="level-item">CMS</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/web/SEO/"><span class="level-start"><span class="level-item">SEO</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/web/angular/"><span class="level-start"><span class="level-item">angular</span></span><span class="level-end"><span class="level-item tag">61</span></span></a></li><li><a class="level is-mobile" href="/categories/web/angularjs/"><span class="level-start"><span class="level-item">angularjs</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/web/browser/"><span class="level-start"><span class="level-item">browser</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/web/build-tools/"><span class="level-start"><span class="level-item">build tools</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/web/components/"><span class="level-start"><span class="level-item">components</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/web/css/"><span class="level-start"><span class="level-item">css</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/web/design/"><span class="level-start"><span class="level-item">design</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/web/html/"><span class="level-start"><span class="level-item">html</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/web/javascript/"><span class="level-start"><span class="level-item">javascript</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/web/material-design/"><span class="level-start"><span class="level-item">material design</span></span><span class="level-end"><span class="level-item tag">17</span></span></a></li><li><a class="level is-mobile" href="/categories/web/nodejs/"><span class="level-start"><span class="level-item">nodejs</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/categories/web/others/"><span class="level-start"><span class="level-item">others</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/web/tauri/"><span class="level-start"><span class="level-item">tauri</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li></ul></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/AI/"><span class="tag">AI</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Android/"><span class="tag">Android</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Angular/"><span class="tag">Angular</span><span class="tag">68</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Ansible/"><span class="tag">Ansible</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CMS/"><span class="tag">CMS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/English/"><span class="tag">English</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Fedora/"><span class="tag">Fedora</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Gemini-AI/"><span class="tag">Gemini AI</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Golang/"><span class="tag">Golang</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hexo/"><span class="tag">Hexo</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/IDEA/"><span class="tag">IDEA</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Java/"><span class="tag">Java</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux/"><span class="tag">Linux</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Material/"><span class="tag">Material</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/NAS/"><span class="tag">NAS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/NPM/"><span class="tag">NPM</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Nodejs/"><span class="tag">Nodejs</span><span class="tag">13</span></a></div><div class="control"><a class="tags has-addons" href="/tags/OS/"><span class="tag">OS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Rust/"><span class="tag">Rust</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SEO/"><span class="tag">SEO</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Seo/"><span class="tag">Seo</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Ubuntu/"><span class="tag">Ubuntu</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Windows/"><span class="tag">Windows</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/angularjs/"><span class="tag">angularjs</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/backend/"><span class="tag">backend</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/bootstrap/"><span class="tag">bootstrap</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/browser/"><span class="tag">browser</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/chartjs/"><span class="tag">chartjs</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/chrome/"><span class="tag">chrome</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/css/"><span class="tag">css</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/database/"><span class="tag">database</span><span class="tag">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/design/"><span class="tag">design</span><span class="tag">16</span></a></div><div class="control"><a class="tags has-addons" href="/tags/docker/"><span class="tag">docker</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/fedora/"><span class="tag">fedora</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/firefox/"><span class="tag">firefox</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/git/"><span class="tag">git</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/gitlab/"><span class="tag">gitlab</span><span class="tag">11</span></a></div><div class="control"><a class="tags has-addons" href="/tags/golang/"><span class="tag">golang</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/gradle/"><span class="tag">gradle</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/html/"><span class="tag">html</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/java/"><span class="tag">java</span><span class="tag">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/javascript/"><span class="tag">javascript</span><span class="tag">62</span></a></div><div class="control"><a class="tags has-addons" href="/tags/k8s/"><span class="tag">k8s</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/less/"><span class="tag">less</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/life/"><span class="tag">life</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/linux/"><span class="tag">linux</span><span class="tag">42</span></a></div><div class="control"><a class="tags has-addons" href="/tags/macOS/"><span class="tag">macOS</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/marketing/"><span class="tag">marketing</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/material-design/"><span class="tag">material design</span><span class="tag">17</span></a></div><div class="control"><a class="tags has-addons" href="/tags/maven/"><span class="tag">maven</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/network/"><span class="tag">network</span><span class="tag">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nginx/"><span class="tag">nginx</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pgadmin/"><span class="tag">pgadmin</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pnpm/"><span class="tag">pnpm</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/product/"><span class="tag">product</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/sass/"><span class="tag">sass</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/sentry/"><span class="tag">sentry</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/shell/"><span class="tag">shell</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/source-control/"><span class="tag">source_control</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/spring/"><span class="tag">spring</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/spring-boot/"><span class="tag">spring boot</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/springboot/"><span class="tag">springboot</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/strapi/"><span class="tag">strapi</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tailwindcss/"><span class="tag">tailwindcss</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tauri/"><span class="tag">tauri</span><span class="tag">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tmux/"><span class="tag">tmux</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/typescript/"><span class="tag">typescript</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/v2ray/"><span class="tag">v2ray</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/v2rayA/"><span class="tag">v2rayA</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/v2rayN/"><span class="tag">v2rayN</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/v2rayNG/"><span class="tag">v2rayNG</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/virualbox/"><span class="tag">virualbox</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/vmware/"><span class="tag">vmware</span><span class="tag">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/vpn/"><span class="tag">vpn</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/vscode/"><span class="tag">vscode</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/web/"><span class="tag">web</span><span class="tag">60</span></a></div><div class="control"><a class="tags has-addons" href="/tags/webpack/"><span class="tag">webpack</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/websocket/"><span class="tag">websocket</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/windows/"><span class="tag">windows</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/wordpress/"><span class="tag">wordpress</span><span class="tag">1</span></a></div></div></div></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#1-前言"><span class="level-left"><span class="level-item">1. 前言</span></span></a></li><li><a class="level is-mobile" href="#2-什么是-Angular-universal"><span class="level-left"><span class="level-item">2. 什么是 Angular universal</span></span></a></li><li><a class="level is-mobile" href="#3-为什么需要-SSR-服务器端渲染"><span class="level-left"><span class="level-item">3. 为什么需要 SSR(服务器端渲染)</span></span></a></li><li><a class="level is-mobile" href="#4-Angular-Universal-如何解决-FCP-和-SEO-问题"><span class="level-left"><span class="level-item">4. Angular Universal 如何解决 FCP 和 SEO 问题</span></span></a></li><li><a class="level is-mobile" href="#5-开启-SSR"><span class="level-left"><span class="level-item">5. 开启 SSR</span></span></a></li><li><a class="level is-mobile" href="#6-开启客户端水合-Client-Hydration"><span class="level-left"><span class="level-item">6. 开启客户端水合(Client Hydration)</span></span></a></li><li><a class="level is-mobile" href="#7-使用-Universal-构建和运行"><span class="level-left"><span class="level-item">7. 使用 Universal 构建和运行</span></span></a></li><li><a class="level is-mobile" href="#8-Prerender-预渲染静态-HTML"><span class="level-left"><span class="level-item">8. Prerender 预渲染静态 HTML</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#8-1-预渲染路径配置"><span class="level-left"><span class="level-item">8.1. 预渲染路径配置</span></span></a></li></ul></li><li><a class="level is-mobile" href="#9-SEO-优化"><span class="level-left"><span class="level-item">9. SEO 优化</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#9-1-关键词与描述的优化"><span class="level-left"><span class="level-item">9.1. 关键词与描述的优化</span></span></a></li><li><a class="level is-mobile" href="#9-2-内部跳转优化"><span class="level-left"><span class="level-item">9.2. 内部跳转优化</span></span></a></li><li><a class="level is-mobile" href="#9-3-样式文件打包"><span class="level-left"><span class="level-item">9.3. 样式文件打包</span></span></a></li><li><a class="level is-mobile" href="#9-4-添加-robots-txt"><span class="level-left"><span class="level-item">9.4. 添加 robots.txt</span></span></a></li><li><a class="level is-mobile" href="#9-5-自动生成-sitemap"><span class="level-left"><span class="level-item">9.5. 自动生成 sitemap</span></span></a></li></ul></li><li><a class="level is-mobile" href="#10-使用-Nginx-部署"><span class="level-left"><span class="level-item">10. 使用 Nginx 部署</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#10-1-安装-Nginx"><span class="level-left"><span class="level-item">10.1. 安装 Nginx</span></span></a></li><li><a class="level is-mobile" href="#10-2-安装-Node"><span class="level-left"><span class="level-item">10.2. 安装 Node</span></span></a></li><li><a class="level is-mobile" href="#10-3-安装-PM2"><span class="level-left"><span class="level-item">10.3. 安装 PM2</span></span></a></li><li><a class="level is-mobile" href="#10-4-配置并启动-pm2"><span class="level-left"><span class="level-item">10.4. 配置并启动 pm2</span></span></a></li><li><a class="level is-mobile" href="#10-5-配置-Nginx-反向代理"><span class="level-left"><span class="level-item">10.5. 配置 Nginx 反向代理</span></span></a></li></ul></li><li><a class="level is-mobile" href="#11-troubleshooting"><span class="level-left"><span class="level-item">11. troubleshooting</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#11-1-问题-1-Configuration-‘development’-is-not-set-in-the-workspace"><span class="level-left"><span class="level-item">11.1. 问题 1: Configuration ‘development’ is not set in the workspace</span></span></a></li><li><a class="level is-mobile" href="#11-2-问题-2-ReferenceError-window-is-not-defined"><span class="level-left"><span class="level-item">11.2. 问题 2: ReferenceError: window is not defined</span></span></a></li><li><a class="level is-mobile" href="#11-3-问题-3-Flex-Layout-loaded-on-the-server-without-FlexLayoutServerModule"><span class="level-left"><span class="level-item">11.3. 问题 3: Flex Layout loaded on the server without FlexLayoutServerModule</span></span></a></li><li><a class="level is-mobile" href="#11-4-问题-4-XMLHttpRequest-is-not-defined"><span class="level-left"><span class="level-item">11.4. 问题 4: XMLHttpRequest is not defined</span></span></a></li><li><a class="level is-mobile" href="#11-5-问题-5：-dist-demo-web-browser-ReferenceError-Image-is-not-defined"><span class="level-left"><span class="level-item">11.5. 问题 5： \dist\demo-web\browser...ReferenceError: Image is not defined</span></span></a></li></ul></li><li><a class="level is-mobile" href="#12-相关阅读"><span class="level-left"><span class="level-item">12. 相关阅读</span></span></a></li><li><a class="level is-mobile" href="#13-参考文档"><span class="level-left"><span class="level-item">13. 参考文档</span></span></a></li></ul></div></div><style>#toc .menu-list>li>a.is-active+.menu-list{display:block}#toc .menu-list>li>a+.menu-list{display:none}</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time datetime="2024-07-10T16:00:00.000Z">2024-07-11</time></p><p class="title"><a href="/network/install_v2rayA_on_Windows.html">2024最新 v2rayA 安装与配置教程 for Windows</a></p><p class="categories"><a href="/categories/network/">network</a> / <a href="/categories/network/v2rayA/">v2rayA</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time datetime="2024-07-08T16:00:00.000Z">2024-07-09</time></p><p class="title"><a href="/hexo/hexo_apply_icarus_theme.html">Hexo配置Icarus主题</a></p><p class="categories"><a href="/categories/tools/">tools</a> / <a href="/categories/tools/hexo/">hexo</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time datetime="2024-07-06T16:00:00.000Z">2024-07-07</time></p><p class="title"><a href="/angular/angular_debug.html">如何调试Angular应用程序</a></p><p class="categories"><a href="/categories/web/">web</a> / <a href="/categories/web/angular/">angular</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time datetime="2024-07-04T16:00:00.000Z">2024-07-05</time></p><p class="title"><a href="/angular/angular_global_error_handling.html">Angular 中的全局错误处理</a></p><p class="categories"><a href="/categories/web/">web</a> / <a href="/categories/web/angular/">angular</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time datetime="2024-07-04T16:00:00.000Z">2024-07-05</time></p><p class="title"><a href="/angular/angular_multiple_interceptors.html">Angular HTTP 拦截器：配置多个HTTP拦截器和 4 个拦截器代码示例</a></p><p class="categories"><a href="/categories/web/">web</a> / <a href="/categories/web/angular/">angular</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2024/07/"><span class="level-start"><span class="level-item">七月 2024</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/06/"><span class="level-start"><span class="level-item">六月 2024</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/05/"><span class="level-start"><span class="level-item">五月 2024</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/04/"><span class="level-start"><span class="level-item">四月 2024</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/03/"><span class="level-start"><span class="level-item">三月 2024</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/02/"><span class="level-start"><span class="level-item">二月 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/01/"><span class="level-start"><span class="level-item">一月 2024</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/12/"><span class="level-start"><span class="level-item">十二月 2023</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/11/"><span class="level-start"><span class="level-item">十一月 2023</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/10/"><span class="level-start"><span class="level-item">十月 2023</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/09/"><span class="level-start"><span class="level-item">九月 2023</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/08/"><span class="level-start"><span class="level-item">八月 2023</span></span><span class="level-end"><span class="level-item tag">25</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/07/"><span class="level-start"><span class="level-item">七月 2023</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/06/"><span class="level-start"><span class="level-item">六月 2023</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/05/"><span class="level-start"><span class="level-item">五月 2023</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/04/"><span class="level-start"><span class="level-item">四月 2023</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/03/"><span class="level-start"><span class="level-item">三月 2023</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/02/"><span class="level-start"><span class="level-item">二月 2023</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/01/"><span class="level-start"><span class="level-item">一月 2023</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/12/"><span class="level-start"><span class="level-item">十二月 2022</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/11/"><span class="level-start"><span class="level-item">十一月 2022</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/10/"><span class="level-start"><span class="level-item">十月 2022</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/09/"><span class="level-start"><span class="level-item">九月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/08/"><span class="level-start"><span class="level-item">八月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/07/"><span class="level-start"><span class="level-item">七月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/06/"><span class="level-start"><span class="level-item">六月 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/05/"><span class="level-start"><span class="level-item">五月 2022</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/04/"><span class="level-start"><span class="level-item">四月 2022</span></span><span class="level-end"><span class="level-item tag">17</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/03/"><span class="level-start"><span class="level-item">三月 2022</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/01/"><span class="level-start"><span class="level-item">一月 2022</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/12/"><span class="level-start"><span class="level-item">十二月 2021</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/11/"><span class="level-start"><span class="level-item">十一月 2021</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/10/"><span class="level-start"><span class="level-item">十月 2021</span></span><span class="level-end"><span class="level-item tag">29</span></span></a></li></ul></div></div></div><div class="card widget" data-type="adsense"><div class="card-content"><div class="menu"><h3 class="menu-label">广告</h3><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9737903136672124" data-ad-slot="9469284888" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">鹏叔的技术博客</a><p class="is-size-7"><span>&copy; 2024 鹏叔</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Follow on GitHub" href="https://github.com/guoapeng"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-cn")</script><script>var IcarusThemeSettings={article:{highlight:{clipboard:!0,fold:"unfolded"}}}</script><script data-pjax src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script data-pjax src="/js/back_to_top.js" defer></script><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load",()=>{window.cookieconsent.initialise({type:"info",theme:"edgeless",static:!1,position:"bottom-left",content:{message:"此网站使用Cookie来改善您的体验。",dismiss:"知道了！",allow:"允许使用Cookie",deny:"拒绝",link:"了解更多",policy:"Cookie政策",href:"https://www.cookiesandyou.com/"},palette:{popup:{background:"#edeff5",text:"#838391"},button:{background:"#4b81e8"}}})})</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load",()=>{"function"==typeof $.fn.lightGallery&&$(".article").lightGallery({selector:".gallery-item"}),"function"==typeof $.fn.justifiedGallery&&($(".justified-gallery > p > .gallery-item").length&&$(".justified-gallery > p > .gallery-item").unwrap(),$(".justified-gallery").justifiedGallery())})</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script src="/js/pjax.js"></script><script data-pjax src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container" id="algolia-input"></div><div id="algolia-poweredby" style="display:flex;margin:0 .5em 0 1em;align-items:center;line-height:0"></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div><div class="searchbox-footer"></div></div></div><script src="https://cdn.jsdelivr.net/npm/algoliasearch@4.0.3/dist/algoliasearch-lite.umd.js" crossorigin="anonymous" defer></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@4.3.1/dist/instantsearch.production.min.js" crossorigin="anonymous" defer></script><script src="/js/algolia.js" defer></script><script>document.addEventListener("DOMContentLoaded",function(){loadAlgolia({applicationId:"FF7977TBCM",apiKey:"e19d2357dac0b28a1a905765619e673a",indexName:"FF7977TBCM"},{hint:"想要查找什么...",no_result:"未找到搜索结果",untitled:"(无标题)",empty_preview:"(无内容预览)"})})</script><script type="text/javascript" src="/js/imaegoo/universe.js"></script></body></html>