<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><meta name="google-site-verification" content="hwu96hHsSnPefhY5oj_Q2reBfC1YuVkwbsuPeuAjSls"><meta name="baidu-site-verification" content="codeva-1TKHma47RE"><script>!function(t,e,n,c,r,a){t[n]=t[n]||function(){(t[n].q=t[n].q||[]).push(arguments)},(r=e.createElement(c)).async=1,r.src="https://www.clarity.ms/tag/cnl2uzz0vb?ref=bwt",(a=e.getElementsByTagName(c)[0]).parentNode.insertBefore(r,a)}(window,document,"clarity","script")</script><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.loli.net/css?family=Noto+Serif+SC:300,300italic,400,400italic,700,700italic%7CPingFang+SC:300,300italic,400,400italic,700,700italic%7CMicrosoft+YaHei:300,300italic,400,400italic,700,700italic%7Csans-serif:300,300italic,400,400italic,700,700italic%7CLato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"www.pengtech.net","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":"enable","bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script><meta name="description" content="Sentry 是一个免费和开源的错误跟踪平台，可以实时监控和修复崩溃。它使软件开发人员能够看到重要的东西，更快地解决问题，并不断了解他们的应用程序。这个平台提供了对生产部署的实时洞察力，并提供了重现和修复崩溃的信息。Sentry 支持所有主要的语言和框架，并与你喜欢的应用程序和服务集成。"><meta property="og:type" content="article"><meta property="og:title" content="如何在Ubuntu 22.04上安装Sentry"><meta property="og:url" content="https://www.pengtech.net/product/sentry_install.html"><meta property="og:site_name" content="鹏叔的技术博客"><meta property="og:description" content="Sentry 是一个免费和开源的错误跟踪平台，可以实时监控和修复崩溃。它使软件开发人员能够看到重要的东西，更快地解决问题，并不断了解他们的应用程序。这个平台提供了对生产部署的实时洞察力，并提供了重现和修复崩溃的信息。Sentry 支持所有主要的语言和框架，并与你喜欢的应用程序和服务集成。"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2023-10-10T16:00:00.000Z"><meta property="article:modified_time" content="2024-06-04T02:00:58.672Z"><meta property="article:author" content="鹏叔"><meta property="article:tag" content="product"><meta property="article:tag" content="sentry"><meta property="article:tag" content="backend"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.pengtech.net/product/sentry_install.html"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.pengtech.net/product/sentry_install.html","path":"product/sentry_install.html","title":"如何在Ubuntu 22.04上安装Sentry"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>如何在Ubuntu 22.04上安装Sentry | 鹏叔的技术博客</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-ZZTM0Y954E"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-ZZTM0Y954E","only_pageview":false}</script><script src="/js/third-party/analytics/google-analytics.js"></script><script src="/js/third-party/analytics/baidu-analytics.js"></script><script async src="https://hm.baidu.com/hm.js?1da0f55a32eb17a877b1b18efa3d0406"></script><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="headband"></div><main class="main"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i> <span class="site-title h1">鹏叔的技术博客</span> <i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">日拱一卒，功不唐捐!</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-angular"><a href="/angular/" rel="section"><i class="fa fa-th fa-fw"></i>angular</a></li><li class="menu-item menu-item-material-design"><a href="/material-design/" rel="section"><i class="fa fa-th fa-fw"></i>material-design</a></li><li class="menu-item menu-item-linux"><a href="/linux/" rel="section"><i class="fa fa-cube fa-fw"></i>linux</a></li><li class="menu-item menu-item-gitlab"><a href="/gitlab/" rel="section"><i class="fa fa-th fa-fw"></i>gitlab</a></li><li class="menu-item menu-item-frontend"><a href="/frontend/" rel="section"><i class="fa fa-mobile fa-fw"></i>frontend</a></li><li class="menu-item menu-item-backend"><a href="/backend/" rel="section"><i class="fa fa-mobile fa-fw"></i>backend</a></li><li class="menu-item menu-item-vscode"><a href="/vscode/" rel="section"><i class="fa fa-th fa-fw"></i>vscode</a></li><li class="menu-item menu-item-hexo"><a href="/hexo/" rel="section"><i class="fa fa-sitemap fa-fw"></i>hexo</a></li><li class="menu-item menu-item-java"><a href="/java/" rel="section"><i class="fa fa-coffee fa-fw"></i>java</a></li><li class="menu-item menu-item-golang"><a href="/golang/" rel="section"><i class="fa fa-cloud fa-fw"></i>golang</a></li><li class="menu-item menu-item-v2raya"><a href="/v2rayA/" rel="section"><i class="fa fa-cloud fa-fw"></i>v2rayA</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6"><span class="nav-number">1.</span> <span class="nav-text">1. 前提条件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E7%A1%AC%E4%BB%B6%E9%85%8D%E7%BD%AE%E8%A6%81%E6%B1%82"><span class="nav-number">2.</span> <span class="nav-text">2. 硬件配置要求</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E7%8E%AF%E5%A2%83"><span class="nav-number">3.</span> <span class="nav-text">3. 环境</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E5%AE%89%E8%A3%85%E6%89%80%E9%9C%80%E7%9A%84%E4%BE%9D%E8%B5%96%E9%A1%B9"><span class="nav-number">3.1.</span> <span class="nav-text">3.1. 安装所需的依赖项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-%E5%AE%89%E8%A3%85-Docker-%E5%92%8C-Docker-Compose"><span class="nav-number">3.2.</span> <span class="nav-text">3.2. 安装 Docker 和 Docker Compose</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-%E5%AE%89%E8%A3%85-Sentry"><span class="nav-number">3.3.</span> <span class="nav-text">3.3. 安装 Sentry</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-%E5%90%AF%E5%8A%A8-Sentry-%E5%AE%B9%E5%99%A8"><span class="nav-number">3.4.</span> <span class="nav-text">3.4. 启动 Sentry 容器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E5%87%86%E5%A4%87%E4%B8%80%E4%B8%AA-nginx%EF%BC%8C%E5%B9%B6%E9%85%8D%E7%BD%AE-https%EF%BC%8C%E5%B0%86%E5%85%B6%E8%BD%AC%E5%8F%91%E5%88%B0-sentry-%E4%B8%BB%E6%9C%BA%E7%9A%84-9000-%E7%AB%AF%E5%8F%A3%E5%8D%B3%E5%8F%AF"><span class="nav-number">4.</span> <span class="nav-text">4. 准备一个 nginx，并配置 https，将其转发到 sentry 主机的 9000 端口即可</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E9%85%8D%E7%BD%AE-DNS"><span class="nav-number">5.</span> <span class="nav-text">5. 配置 DNS</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-%E9%85%8D%E7%BD%AE-nginx"><span class="nav-number">6.</span> <span class="nav-text">6. 配置 nginx</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-%E5%A6%82%E4%BD%95%E6%89%93%E6%89%AB%E6%95%B0%E6%8D%AE"><span class="nav-number">7.</span> <span class="nav-text">7. 如何打扫数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-troubleshooting"><span class="nav-number">8.</span> <span class="nav-text">8. troubleshooting</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="鹏叔" src="/imgs/avatar.gif"><p class="site-author-name" itemprop="name">鹏叔</p><div class="site-description" itemprop="description">鹏叔的技术博客, 鹏叔的技术博客, 收集鹏叔在日常工作中整理的技术博客, 内容包括前端javascript, material design, typescript, css, html, 后端golang, java, 数据库等.</div></div><div class="site-state-wrap site-overview-item animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">250</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">35</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">76</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author site-overview-item animated"><span class="links-of-author-item"><a href="https://github.com/guoapeng" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;guoapeng" rel="noopener external nofollow" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:guoapeng@gmail.com" title="E-Mail → mailto:guoapeng@gmail.com" rel="noopener external nofollow" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a></span></div><div class="cc-license site-overview-item animated" itemprop="license"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" class="cc-opacity" rel="noopener external nofollow" target="_blank"><img src="https://cdn.jsdelivr.net/npm/@creativecommons/vocabulary@2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a></div><div class="links-of-blogroll site-overview-item animated"><div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i> 友情链接</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="https://philoenglish.com/" title="https:&#x2F;&#x2F;philoenglish.com" target="_blank">菲利英语</a></li></ul></div></div></div><div class="back-to-top animated" role="button" aria-label="返回顶部"><i class="fa fa-arrow-up"></i> <span>0%</span></div></div></aside><div class="sidebar-dimmer"></div></header><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.pengtech.net/product/sentry_install.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/imgs/avatar.gif"><meta itemprop="name" content="鹏叔"><meta itemprop="description" content="鹏叔的技术博客, 鹏叔的技术博客, 收集鹏叔在日常工作中整理的技术博客, 内容包括前端javascript, material design, typescript, css, html, 后端golang, java, 数据库等."></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="鹏叔的技术博客"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">如何在Ubuntu 22.04上安装Sentry</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2023-10-11 00:00:00" itemprop="dateCreated datePublished" datetime="2023-10-11T00:00:00+08:00">2023-10-11</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2024-06-04 10:00:58" itemprop="dateModified" datetime="2024-06-04T10:00:58+08:00">2024-06-04</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/backend/" itemprop="url" rel="index"><span itemprop="name">backend</span></a> </span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i> </span><span class="post-meta-item-text">阅读次数：</span> <span id="busuanzi_value_page_pv"></span> </span><span class="post-meta-break"></span> <span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>12k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>10 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><p>Sentry 是一个免费和开源的错误跟踪平台，可以实时监控和修复崩溃。它使软件开发人员能够看到重要的东西，更快地解决问题，并不断了解他们的应用程序。这个平台提供了对生产部署的实时洞察力，并提供了重现和修复崩溃的信息。Sentry 支持所有主要的语言和框架，并与你喜欢的应用程序和服务集成。</p><span id="more"></span><h2 id="1-前提条件"><a href="#1-前提条件" class="headerlink" title="1. 前提条件"></a>1. <strong>前提条件</strong></h2><ul><li>一台运行 Ubuntu 22.04 的服务器。</li><li>一个有效的域名被指向你的服务器 IP。</li><li>在你的服务器上配置了一个根密码。</li></ul><h2 id="2-硬件配置要求"><a href="#2-硬件配置要求" class="headerlink" title="2. 硬件配置要求"></a>2. 硬件配置要求</h2><p>安装 self-hosted sentry 需要的硬件配置取决于您的应用程序的大小和复杂性。以下是一些一般建议：</p><p>CPU： 至少 2 核。如果您的应用程序非常复杂，则需要更多核。<br>内存： 至少 4GB。如果您的应用程序生成大量日志，则需要更多内存。<br>存储： 至少 20GB。如果您的应用程序生成大量日志，则需要更多存储空间。<br>网络： 至少 100Mbps。如果您的应用程序生成大量日志，则需要更高的网络带宽。</p><p>以下是一些具体的配置建议：</p><p>对于小型应用程序（&lt;100 个用户）， 您可以使用以下配置：</p><ul><li>CPU：2 核</li><li>内存：4GB</li><li>存储：20GB</li><li>网络：100Mbps</li></ul><p>对于中型应用程序（100-1,000 个用户）， 您可以使用以下配置：</p><ul><li>CPU：4 核</li><li>内存：8GB</li><li>存储：60GB</li><li>网络：500Mbps</li></ul><p>对于大型应用程序（&gt;1,000 个用户）， 您可以使用以下配置：</p><ul><li>CPU：8 核</li><li>内存：16GB</li><li>存储：120GB</li><li>网络：1Gbps</li></ul><p>可以根据需要调整这些建议。例如，如果希望 sentry 能够处理更高的并发连接，则需要更多的 CPU 和内存。如果希望 sentry 能够存储更长时间的日志，则需要更多的存储空间。</p><p>您可以使用 Sentry 提供的 <a target="_blank" rel="noopener" href="https://docs.sentry.io/performance/">性能指南</a> 来帮助您确定适合您应用程序的硬件配置。</p><h2 id="3-环境"><a href="#3-环境" class="headerlink" title="3. 环境"></a>3. 环境</h2><p>本教程实验环境</p><p>Ubuntu 22.04.1<br>Docker 24.0.5<br>Docker-Compose 2.22.0<br>Sentry 23.11.0</p><h3 id="3-1-安装所需的依赖项"><a href="#3-1-安装所需的依赖项" class="headerlink" title="3.1. 安装所需的依赖项"></a>3.1. <strong>安装所需的依赖项</strong></h3><p>在开始之前，建议将你的软件包更新到最新版本。你可以用以下命令来更新它们：</p><p>配置国内的镜像源, 并更新.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update -y</span><br><span class="line"><span class="comment"># apt upgrade会更新内核, 请谨慎使用</span></span><br><span class="line"><span class="comment">#sudo apt upgrade -y</span></span><br></pre></td></tr></table></figure><p>如果您以前安装过 containerd 或 runc，请卸载它们以避免与 Docker Engine 捆绑的版本发生冲突。</p><p>运行以下命令卸载所有冲突的程序包：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">for</span> pkg <span class="keyword">in</span> docker.io docker-doc docker-compose docker-compose-v2 podman-docker containerd runc; <span class="keyword">do</span> sudo apt-get remove <span class="variable">$pkg</span>; <span class="keyword">done</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>一旦你的系统被更新，用下面的命令安装所有需要的软件包：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install curl git build-essential apt-transport-https ca-certificates software-properties-common gnupg -y</span><br></pre></td></tr></table></figure><h3 id="3-2-安装-Docker-和-Docker-Compose"><a href="#3-2-安装-Docker-和-Docker-Compose" class="headerlink" title="3.2. 安装 Docker 和 Docker Compose"></a>3.2. <strong>安装 Docker 和 Docker Compose</strong></h3><p>默认情况下，最新版本的 Docker 和 Docker Compose 包在 Ubuntu 22.04 的默认软件库中是不可用的。所以你需要在 APT 中添加 Docker 官方仓库。</p><p>首先，用以下命令下载并添加 Docker GPG 密钥:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo install -m 0755 -d /etc/apt/keyrings</span><br><span class="line"></span><br><span class="line">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg</span><br><span class="line"></span><br><span class="line">sudo chmod a+r /etc/apt/keyrings/docker.gpg</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>接下来，用下面的命令添加 Docker 存储库:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">echo</span> \</span><br><span class="line">  <span class="string">&quot;deb [arch=&quot;</span>$(dpkg --print-architecture)<span class="string">&quot; signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \</span></span><br><span class="line"><span class="string">  &quot;</span>$(. /etc/os-release &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$VERSION_CODENAME</span>&quot;</span>)<span class="string">&quot; stable&quot;</span> | \</span><br><span class="line">  sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>一旦版本库被添加，用以下命令更新版本库缓存。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update -y</span><br></pre></td></tr></table></figure><p>接下来，用下面的命令安装 Docker 和 Docker Compose。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装最新版本</span></span><br><span class="line">sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者, 像这样安装指定版本</span></span><br><span class="line"><span class="comment"># List the available versions:</span></span><br><span class="line">apt-cache madison docker-ce | awk <span class="string">&#x27;&#123; print $3 &#125;&#x27;</span></span><br><span class="line">VERSION_STRING=5:24.0.0-1~ubuntu.22.04~jammy</span><br><span class="line">sudo apt-get install docker-ce=<span class="variable">$VERSION_STRING</span> docker-ce-cli=<span class="variable">$VERSION_STRING</span> containerd.io docker-buildx-plugin docker-compose-plugin</span><br></pre></td></tr></table></figure><p>配置镜像加速</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">echo</span> -e \</span><br><span class="line"><span class="string">&quot;&#123; \n&quot;</span> \</span><br><span class="line"><span class="string">&quot;    \&quot;registry-mirrors\&quot;: [\&quot;https://&lt;你的ID&gt;.mirror.aliyuncs.com\&quot;], \n&quot;</span> \</span><br><span class="line"><span class="string">&quot;    \&quot;live-restore\&quot;: true,\n&quot;</span> \</span><br><span class="line"><span class="string">&quot;    \&quot;debug\&quot;: true\n&quot;</span> \</span><br><span class="line"><span class="string">&quot;&#125;&quot;</span> | sudo tee /etc/docker/daemon.json &gt; /dev/null</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>安装 docker-compose</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">sudo curl -L https://github.com/docker/compose/releases/download/v2.22.0/docker-compose-`uname -s`-`uname -m` -o /usr/bin/docker-compose</span><br><span class="line"></span><br><span class="line"><span class="comment"># 授予docker-compose可执行权限</span></span><br><span class="line">sudo chmod +x /usr/bin/docker-compose</span><br></pre></td></tr></table></figure><p>如果下载速度太慢, 可以通过一台可以快速访问 github 的电脑手动下载 docker-compose, 然后上传至服务器.</p><p>查看 docker 和 docker-compose 版本信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ docker -v</span><br><span class="line">Docker version 24.0.7, build afdd53b</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ docker-compose -v</span><br><span class="line">Docker Compose version v2.22.0</span><br></pre></td></tr></table></figure><p>查看镜像配置是否成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker info</span><br></pre></td></tr></table></figure><p>如果镜像仓库显示有如下内容，则配置成功。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Registry Mirrors:</span><br><span class="line"> https://your_id.mirror.aliyuncs.com/   <span class="comment">#如果这里显示这里刚才的配置的地址,则配置成功</span></span><br><span class="line">Live Restore Enabled: <span class="literal">false</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>安装好这两个软件包后，用以下命令启动 Docker 服务并使其在系统重启时启动：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start docker</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> docker</span><br></pre></td></tr></table></figure><p>现在你可以用下面的命令来验证 Docker 的状态：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl status docker</span><br></pre></td></tr></table></figure><p>你应该得到以下输出：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">? docker.service - Docker Application Container Engine</span><br><span class="line">     Loaded: loaded (/lib/systemd/system/docker.service; enabled; vendor preset: enabled)</span><br><span class="line">     Active: active (running) since Tue 2023-01-10 04:37:27 UTC; 5s ago</span><br><span class="line">TriggeredBy: ? docker.socket</span><br><span class="line">       Docs: https://docs.docker.com</span><br><span class="line">   Main PID: 45847 (dockerd)</span><br><span class="line">      Tasks: 8</span><br><span class="line">     Memory: 29.1M</span><br><span class="line">        CPU: 220ms</span><br><span class="line">     CGroup: /system.slice/docker.service</span><br><span class="line">             ??45847 /usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock</span><br><span class="line"></span><br><span class="line">Jan 10 04:37:26 vultr dockerd[45847]: time=<span class="string">&quot;2023-01-10T04:37:26.903435377Z&quot;</span> level=info msg=<span class="string">&quot;scheme \&quot;unix\&quot; not registered, fallback to defau&gt;</span></span><br><span class="line"><span class="string">Jan 10 04:37:26 vultr dockerd[45847]: time=&quot;</span>2023-01-10T04:37:26.903453803Z<span class="string">&quot; level=info msg=&quot;</span>ccResolverWrapper: sending update to cc: &#123;[&#123;unix:&gt;</span><br><span class="line">Jan 10 04:37:26 vultr dockerd[45847]: time=<span class="string">&quot;2023-01-10T04:37:26.903464761Z&quot;</span> level=info msg=<span class="string">&quot;ClientConn switching balancer to \&quot;pick_first\&quot;&quot;</span> &gt;</span><br><span class="line">Jan 10 04:37:26 vultr dockerd[45847]: time=<span class="string">&quot;2023-01-10T04:37:26.916581613Z&quot;</span> level=info msg=<span class="string">&quot;Loading containers: start.&quot;</span></span><br><span class="line">Jan 10 04:37:26 vultr dockerd[45847]: time=<span class="string">&quot;2023-01-10T04:37:26.997807510Z&quot;</span> level=info msg=<span class="string">&quot;Default bridge (docker0) is assigned with an IP a&gt;</span></span><br><span class="line"><span class="string">Jan 10 04:37:27 vultr dockerd[45847]: time=&quot;</span>2023-01-10T04:37:27.060381720Z<span class="string">&quot; level=info msg=&quot;</span>Loading containers: <span class="keyword">done</span>.<span class="string">&quot;</span></span><br><span class="line"><span class="string">Jan 10 04:37:27 vultr dockerd[45847]: time=&quot;</span>2023-01-10T04:37:27.074467014Z<span class="string">&quot; level=info msg=&quot;</span>Docker daemon<span class="string">&quot; commit=20.10.12-0ubuntu4 graphdriv&gt;</span></span><br><span class="line"><span class="string">Jan 10 04:37:27 vultr dockerd[45847]: time=&quot;</span>2023-01-10T04:37:27.074649813Z<span class="string">&quot; level=info msg=&quot;</span>Daemon has completed initialization<span class="string">&quot;</span></span><br><span class="line"><span class="string">Jan 10 04:37:27 vultr systemd[1]: Started Docker Application Container Engine.</span></span><br><span class="line"><span class="string">Jan 10 04:37:27 vultr dockerd[45847]: time=&quot;</span>2023-01-10T04:37:27.092699576Z<span class="string">&quot; level=info msg=&quot;</span>API listen on /run/docker.sock<span class="string">&quot;</span></span><br></pre></td></tr></table></figure><h3 id="3-3-安装-Sentry"><a href="#3-3-安装-Sentry" class="headerlink" title="3.3. 安装 Sentry"></a>3.3. <strong>安装 Sentry</strong></h3><p>首先，使用以下命令从 Git 仓库下载最新版本的 Sentry：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/getsentry/self-hosted.git</span><br></pre></td></tr></table></figure><p>下载完成后，将目录改为下载的目录，并运行 Sentry 安装脚本，开始安装。</p><p>vi ~/self-hosted/.env</p><p>将 event 保留时间修改成 90 天, 默认是 30 天</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">COMPOSE_PROJECT_NAME=sentry-self-hosted</span><br><span class="line">SENTRY_EVENT_RETENTION_DAYS=30</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> self-hosted</span><br><span class="line"><span class="comment"># 切换到release版本</span></span><br><span class="line">git checkout 23.10.1</span><br><span class="line"><span class="comment"># 安装sentry</span></span><br><span class="line"><span class="comment"># 这里为了避免中间弹出prompt提示创建超级用户,</span></span><br><span class="line"><span class="comment"># 使用skip-user-creation选项跳过了了超级用户创建</span></span><br><span class="line"><span class="comment"># 后续会有单独的步骤创建超级用户</span></span><br><span class="line">sudo ./install.sh --no-report-self-hosted-issues --skip-user-creation</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建超级用户</span></span><br><span class="line"><span class="comment"># 将email替换成你的管理员email, password做相应替换</span></span><br><span class="line">docker-compose --ansi never run --rm web createuser --force-update --superuser --email user@example.com --password secret</span><br></pre></td></tr></table></figure><p>自托管监控</p><p>当运行./install.sh 时，您可以选择加入或退出 sentry 官方的监控。此监控用于开发和调试目的，以便我们能够掌握您面临的问题，从而使我们能够提供更加无缝的安装过程。</p><p>请注意，从 22.11.0 版本开始，选择是否发送错误将成为强制要求。</p><p>在安装过程中，你会被要求创建一个管理员账户，如下图所示：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Here<span class="string">&#x27;s the info we may collect:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  - OS username</span></span><br><span class="line"><span class="string">  - IP address</span></span><br><span class="line"><span class="string">  - install log</span></span><br><span class="line"><span class="string">  - runtime errors</span></span><br><span class="line"><span class="string">  - performance data</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Thirty (30) day retention. No marketing. Privacy policy at sentry.io/privacy.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Would you like to create a user account now? [Y/n]: y</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Email: Email: your_email@xxx.com</span></span><br><span class="line"><span class="string">Password:</span></span><br><span class="line"><span class="string">Repeat for confirmation:</span></span><br><span class="line"><span class="string">Added to organization: sentry</span></span><br><span class="line"><span class="string">User created: your_email@xxx.com</span></span><br><span class="line"><span class="string">Creating missing DSNs</span></span><br><span class="line"><span class="string">Correcting Group.num_comments counter</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-----------------------------------------------------------------</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">You&#x27;</span>re all <span class="keyword">done</span>! Run the following <span class="built_in">command</span> to get Sentry running:</span><br><span class="line"></span><br><span class="line">  docker-compose up -d</span><br><span class="line"></span><br><span class="line">-----------------------------------------------------------------</span><br></pre></td></tr></table></figure><p>接下来，使用以下命令验证所有下载的镜像。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure><p>你应该看到以下输出。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">REPOSITORY                               TAG             IMAGE ID       CREATED         SIZE</span><br><span class="line">vroom-cleanup-self-hosted-local          latest          ea9a97a173e4   8 hours ago     119MB</span><br><span class="line">symbolicator-cleanup-self-hosted-local   latest          ddf3f91711b9   8 hours ago     139MB</span><br><span class="line">sentry-cleanup-self-hosted-local         latest          3f649c2adb51   8 hours ago     1.04GB</span><br><span class="line">&lt;none&gt;                                   &lt;none&gt;          e6275ee189a4   8 hours ago     1.04GB</span><br><span class="line">&lt;none&gt;                                   &lt;none&gt;          ffb03d72b02c   8 hours ago     1.04GB</span><br><span class="line">sentry-self-hosted-local                 latest          7e021f899f9d   8 hours ago     1.04GB</span><br><span class="line">&lt;none&gt;                                   &lt;none&gt;          7e93f5ff254c   8 hours ago     1.04GB</span><br><span class="line">&lt;none&gt;                                   &lt;none&gt;          cfb9b6b7e493   8 hours ago     1.04GB</span><br><span class="line">&lt;none&gt;                                   &lt;none&gt;          b25501401a89   8 hours ago     1.04GB</span><br><span class="line">&lt;none&gt;                                   &lt;none&gt;          83f5784ea774   8 hours ago     1.04GB</span><br><span class="line">&lt;none&gt;                                   &lt;none&gt;          a25a2fe8d5dd   8 hours ago     1.04GB</span><br><span class="line">&lt;none&gt;                                   &lt;none&gt;          247203428a29   8 hours ago     1.04GB</span><br><span class="line">&lt;none&gt;                                   &lt;none&gt;          b317e37159df   8 hours ago     1.04GB</span><br><span class="line">&lt;none&gt;                                   &lt;none&gt;          acb9c8ac94a4   8 hours ago     1.04GB</span><br><span class="line">&lt;none&gt;                                   &lt;none&gt;          8798646a9a6e   8 hours ago     1.04GB</span><br><span class="line">&lt;none&gt;                                   &lt;none&gt;          eeb84b793191   8 hours ago     1.04GB</span><br><span class="line">&lt;none&gt;                                   &lt;none&gt;          33786daa04f9   8 hours ago     1.04GB</span><br><span class="line">&lt;none&gt;                                   &lt;none&gt;          e9207519f5ea   8 hours ago     1.04GB</span><br><span class="line">&lt;none&gt;                                   &lt;none&gt;          5a6bc83fb1d5   8 hours ago     1.04GB</span><br><span class="line">&lt;none&gt;                                   &lt;none&gt;          284a0389a802   8 hours ago     1.04GB</span><br><span class="line">&lt;none&gt;                                   &lt;none&gt;          01822573c6da   8 hours ago     1.04GB</span><br><span class="line">&lt;none&gt;                                   &lt;none&gt;          863ad8d9962c   8 hours ago     1.04GB</span><br><span class="line">sentry-self-hosted-jq-local              latest          802ce2121fdc   9 hours ago     76.8MB</span><br><span class="line">getsentry/sentry                         nightly         fab0bb9cf072   17 hours ago    1.04GB</span><br><span class="line">getsentry/relay                          nightly         da690b7dffe9   2 days ago      277MB</span><br><span class="line">getsentry/snuba                          nightly         58aa2f0ddbd0   2 days ago      1.08GB</span><br><span class="line">getsentry/vroom                          nightly         4248c1746c67   2 days ago      118MB</span><br><span class="line">debian                                   bookworm-slim   8edcf5b83723   11 days ago     74.8MB</span><br><span class="line">getsentry/symbolicator                   nightly         29b78918bd5a   2 weeks ago     137MB</span><br><span class="line">nginx                                    1.25.2-alpine   661daf9bcac8   3 weeks ago     42.6MB</span><br><span class="line">getsentry/sentry-cli                     latest          329fdf92d508   2 months ago    27.3MB</span><br><span class="line">busybox                                  latest          a416a98b71e2   3 months ago    4.26MB</span><br><span class="line">ghcr.io/maxmind/geoipupdate              v6.0.0          3fdbd1ffd226   4 months ago    15.5MB</span><br><span class="line">redis                                    6.2.13-alpine   529fcf955ad4   4 months ago    28MB</span><br><span class="line">memcached                                1.6.21-alpine   2db2248e0a53   4 months ago    10.3MB</span><br><span class="line">postgres                                 14.5            cefd1c9e490c   12 months ago   376MB</span><br><span class="line">tianon/exim4                             latest          a56a3348ddb1   21 months ago   158MB</span><br><span class="line">clickhouse-self-hosted-local             latest          79441da6ab2b   22 months ago   706MB</span><br><span class="line">confluentinc/cp-kafka                    5.5.7           b362671f2bc0   22 months ago   737MB</span><br><span class="line">confluentinc/cp-zookeeper                5.5.7           22b646e1afd0   22 months ago   737MB</span><br><span class="line">curlimages/curl                          7.77.0          e062233fb4a9   2 years ago     8.26MB</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3-4-启动-Sentry-容器"><a href="#3-4-启动-Sentry-容器" class="headerlink" title="3.4. 启动 Sentry 容器"></a>3.4. <strong>启动 Sentry 容器</strong></h3><p>在这一点上，Sentry 已经安装完毕。现在你可以使用以下命令启动 Sentry 容器：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动服务</span></span><br><span class="line">sudo docker-compose up -d</span><br><span class="line"><span class="comment"># 如果需要停止服务, 使用如下命令</span></span><br><span class="line">sudo docker-compose down </span><br></pre></td></tr></table></figure><p>这将启动 Sentry 的所有容器，如下所示：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Starting sentry_onpremise_memcached_1            ... <span class="keyword">done</span></span><br><span class="line">Starting sentry_onpremise_redis_1                ... <span class="keyword">done</span></span><br><span class="line">Starting sentry_onpremise_symbolicator_1         ... <span class="keyword">done</span></span><br><span class="line">Creating sentry_onpremise_symbolicator-cleanup_1 ... <span class="keyword">done</span></span><br><span class="line">Starting sentry_onpremise_zookeeper_1            ... <span class="keyword">done</span></span><br><span class="line">Starting sentry_onpremise_clickhouse_1           ... <span class="keyword">done</span></span><br><span class="line">Starting sentry_onpremise_smtp_1                 ... <span class="keyword">done</span></span><br><span class="line">Starting sentry_onpremise_postgres_1             ... <span class="keyword">done</span></span><br><span class="line">Starting sentry_onpremise_kafka_1                ... <span class="keyword">done</span></span><br><span class="line">Starting sentry_onpremise_snuba-consumer_1          ... <span class="keyword">done</span></span><br><span class="line">Starting sentry_onpremise_snuba-outcomes-consumer_1 ... <span class="keyword">done</span></span><br><span class="line">Starting sentry_onpremise_snuba-api_1               ... <span class="keyword">done</span></span><br><span class="line">Starting sentry_onpremise_snuba-sessions-consumer_1 ... <span class="keyword">done</span></span><br><span class="line">Starting sentry_onpremise_snuba-replacer_1          ... <span class="keyword">done</span></span><br><span class="line">Creating sentry_onpremise_snuba-cleanup_1           ... <span class="keyword">done</span></span><br><span class="line">Creating sentry_onpremise_relay_1                   ... <span class="keyword">done</span></span><br><span class="line">Creating sentry_onpremise_web_1                     ... <span class="keyword">done</span></span><br><span class="line">Creating sentry_onpremise_post-process-forwarder_1  ... <span class="keyword">done</span></span><br><span class="line">Creating sentry_onpremise_cron_1                    ... <span class="keyword">done</span></span><br><span class="line">Creating sentry_onpremise_sentry-cleanup_1          ... <span class="keyword">done</span></span><br><span class="line">Creating sentry_onpremise_worker_1                  ... <span class="keyword">done</span></span><br><span class="line">Creating sentry_onpremise_ingest-consumer_1         ... <span class="keyword">done</span></span><br><span class="line">Creating sentry_onpremise_nginx_1                   ... <span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>你可以使用下面的命令验证所有容器的状态。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker-compose ps</span><br></pre></td></tr></table></figure><p>访问 Sentry Web UI</p><p>此时，Sentry 已经启动，并在 9000 端口上监听。现在，打开你的网页浏览器，输入网址<a target="_blank" rel="noopener" href="http://your-server-ip:9000/">http://your-server-ip:9000</a>，访问 Sentry 仪表板。你将会被转到 Sentry 的登录页面.</p><h2 id="4-准备一个-nginx，并配置-https，将其转发到-sentry-主机的-9000-端口即可"><a href="#4-准备一个-nginx，并配置-https，将其转发到-sentry-主机的-9000-端口即可" class="headerlink" title="4. 准备一个 nginx，并配置 https，将其转发到 sentry 主机的 9000 端口即可"></a>4. 准备一个 nginx，并配置 https，将其转发到 sentry 主机的 9000 端口即可</h2><p>安装 nginx 可以参考我的文章<a href="https://www.pengtech.net/nginx/nginx_installation.html">nginx 安装教程</a></p><h2 id="5-配置-DNS"><a href="#5-配置-DNS" class="headerlink" title="5. 配置 DNS"></a>5. 配置 DNS</h2><p>添加一条新的 DNS A 记录例如 sentry_host.your_domain.com 指向公网 ip</p><h2 id="6-配置-nginx"><a href="#6-配置-nginx" class="headerlink" title="6. 配置 nginx"></a>6. 配置 nginx</h2><p>修改</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span>  sentry_host.your_domain.com;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^(.*)$</span> https://$host<span class="variable">$1</span> <span class="literal">permanent</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span>;</span><br><span class="line">    <span class="attribute">server_name</span> sentry_host.your_domain.com;</span><br><span class="line">    <span class="attribute">ssl</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">ssl_certificate</span>  /etc/nginx/ssl/sentry_host.your_domain.com.pem;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /etc/nginx/ssl/sentry_host.your_domain.com.key;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> /admin &#123;</span><br><span class="line">        <span class="attribute">return</span> <span class="number">404</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host $host;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://sentry_host_ip:9000/;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="7-如何打扫数据"><a href="#7-如何打扫数据" class="headerlink" title="7. 如何打扫数据"></a>7. 如何打扫数据</h2><p>vi ~/self-hosted/docker-compose.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="attr">environment:</span></span><br><span class="line">   <span class="attr">PYTHONUSERBASE:</span> <span class="string">&quot;/data/custom-packages&quot;</span></span><br><span class="line">   <span class="attr">SENTRY_CONF:</span> <span class="string">&quot;/etc/sentry&quot;</span></span><br><span class="line">    <span class="string">.....</span></span><br><span class="line">   <span class="attr">SENTRY_EVENT_RETENTION_DAYS:</span> <span class="number">7</span></span><br><span class="line">   <span class="attr">SENTRY_MAIL_HOST:</span></span><br><span class="line">   <span class="attr">SENTRY_MAX_EXTERNAL_SOURCEMAP_SIZE:</span></span><br><span class="line">   <span class="comment"># Set this value if you plan on using the Suggested Fix Feature</span></span><br><span class="line">   <span class="attr">OPENAI_API_KEY:</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>重启Sentry</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker-compose down &amp; sudo docker-compose up -d</span><br></pre></td></tr></table></figure><p>参考: <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/74683876/how-sentry-is-cleaned-up-correctly">How Sentry is cleaned up correctly</a></p><h2 id="8-troubleshooting"><a href="#8-troubleshooting" class="headerlink" title="8. troubleshooting"></a>8. troubleshooting</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">RUN <span class="built_in">echo</span> <span class="string">&#x27;deb http://mirrors.aliyun.com/debian-archive/debian stretch main contrib non-free\n\</span></span><br><span class="line"><span class="string">deb http://mirrors.aliyun.com/debian-archive/debian stretch-proposed-updates main contrib non-free\n\</span></span><br><span class="line"><span class="string">deb http://mirrors.aliyun.com/debian-archive/debian-security/ stretch/updates main contrib non-free\n&#x27;</span>\</span><br><span class="line">&gt; /etc/apt/sources.list</span><br></pre></td></tr></table></figure></div><footer class="post-footer"><div class="reward-container"><div>您的支持是我创作深度好文的源动力!</div><button>赞赏</button><div class="post-reward"><div><img src="/imgs/rewards/wechatpay.jpg" alt="鹏叔 微信"> <span>微信</span></div><div><img src="/imgs/rewards/alipay.jpg" alt="鹏叔 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"><strong>本文作者： </strong>鹏叔</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://www.pengtech.net/product/sentry_install.html" title="如何在Ubuntu 22.04上安装Sentry">https://www.pengtech.net/product/sentry_install.html</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" rel="noopener external nofollow" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="post-tags"><a href="/tags/product/" rel="tag"><i class="fa fa-tag"></i> product</a> <a href="/tags/sentry/" rel="tag"><i class="fa fa-tag"></i> sentry</a> <a href="/tags/backend/" rel="tag"><i class="fa fa-tag"></i> backend</a></div><div class="post-nav"><div class="post-nav-item"><a href="/strapi/strapi_deployment.html" rel="prev" title="使用rpm部署Strapi"><i class="fa fa-chevron-left"></i> 使用rpm部署Strapi</a></div><div class="post-nav-item"><a href="/material/material3_foundations.html" rel="next" title="Material 3 基础">Material 3 基础 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments utterances-container"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">鹏叔</span></div><div class="wordcount"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i> </span><span>站点总字数：</span> <span title="站点总字数">1.3m</span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span>站点阅读时长 &asymp;</span> <span title="站点阅读时长">19:58</span></span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i> </span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span> </span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="powered-by">由 <a href="https://hexo.io/" rel="noopener external nofollow" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener external nofollow" target="_blank">NexT.Mist</a> 强力驱动</div><div class="addthis_inline_share_toolbox"><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-615fe625918d4f20" async></script></div></div></footer><script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script><script src="/js/third-party/search/local-search.js"></script><script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdn.jsdelivr.net/npm/mermaid@8.13.2/dist/mermaid.min.js","integrity":"sha256-UIQPVkGifpwMvDH5yGgORJ9sSTDq38zz6BGU6dNaKhM="}}</script><script src="/js/third-party/tags/mermaid.js"></script><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"guoapeng/guoapeng.github.io","issue_term":"pathname","theme":"github-light","cdn":"https://utteranc.es/client.js"}</script><script src="/js/third-party/comments/utterances.js"></script></body></html>